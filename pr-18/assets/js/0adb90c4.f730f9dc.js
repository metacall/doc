"use strict";(globalThis.webpackChunkmetacall_doc=globalThis.webpackChunkmetacall_doc||[]).push([[6666],{6500:(i,e,n)=>{n.r(e),n.d(e,{assets:()=>r,contentTitle:()=>o,default:()=>h,frontMatter:()=>s,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"metacall-core/initialization-and-shutdown","title":"Initialization and Shutdown","description":"This page documents the initialization and shutdown procedures for the MetaCall runtime environment across different programming languages. Proper initialization is essential for setting up the runtime environment before making cross-language function calls, while orderly shutdown ensures resources are released correctly.","source":"@site/docs/metacall-core/initialization-and-shutdown.md","sourceDirName":"metacall-core","slug":"/metacall-core/initialization-and-shutdown","permalink":"/doc/pr-18/docs/metacall-core/initialization-and-shutdown","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Initialization and Shutdown"},"sidebar":"tutorialSidebar","previous":{"title":"Go Port","permalink":"/doc/pr-18/docs/metacall-core/go-port"},"next":{"title":"Java Loader","permalink":"/doc/pr-18/docs/metacall-core/java-loader"}}');var a=n(4848),l=n(8453);const s={title:"Initialization and Shutdown"},o="Initialization and Shutdown",r={},c=[{value:"Core Initialization Process",id:"core-initialization-process",level:2},{value:"Basic Initialization",id:"basic-initialization",level:3},{value:"Extended Initialization with Configuration",id:"extended-initialization-with-configuration",level:3},{value:"Command-line Arguments",id:"command-line-arguments",level:3},{value:"Auto-initialization Mechanism",id:"auto-initialization-mechanism",level:3},{value:"Node.js Initialization",id:"nodejs-initialization",level:2},{value:"Shutdown Process",id:"shutdown-process",level:2},{value:"Loader Initialization and Destruction",id:"loader-initialization-and-destruction",level:2},{value:"Checking Initialization Status",id:"checking-initialization-status",level:2},{value:"Settings Flags During Initialization",id:"settings-flags-during-initialization",level:2},{value:"Initialization and Shutdown in C/C++",id:"initialization-and-shutdown-in-cc",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Lifecycle Diagram",id:"lifecycle-diagram",level:2},{value:"Value Validation During Operations",id:"value-validation-during-operations",level:2},{value:"Troubleshooting Initialization Issues",id:"troubleshooting-initialization-issues",level:2}];function d(i){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,l.R)(),...i.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.header,{children:(0,a.jsx)(e.h1,{id:"initialization-and-shutdown",children:"Initialization and Shutdown"})}),"\n",(0,a.jsx)(e.p,{children:"This page documents the initialization and shutdown procedures for the MetaCall runtime environment across different programming languages. Proper initialization is essential for setting up the runtime environment before making cross-language function calls, while orderly shutdown ensures resources are released correctly."}),"\n",(0,a.jsx)(e.h2,{id:"core-initialization-process",children:"Core Initialization Process"}),"\n",(0,a.jsx)(e.p,{children:"MetaCall employs a lifecycle management system that requires initialization before use and proper shutdown to prevent resource leaks. The initialization flow sets up multiple subsystems including logging, dynamic loading, type conversion, and serialization."}),"\n",(0,a.jsx)(e.h3,{id:"basic-initialization",children:"Basic Initialization"}),"\n",(0,a.jsxs)(e.p,{children:["The simplest way to initialize MetaCall is by calling ",(0,a.jsx)(e.code,{children:"metacall_initialize()"}),", which prepares the runtime environment with default settings:"]}),"\n",(0,a.jsx)(e.h3,{id:"extended-initialization-with-configuration",children:"Extended Initialization with Configuration"}),"\n",(0,a.jsxs)(e.p,{children:["For more control over the initialization process, ",(0,a.jsx)(e.code,{children:"metacall_initialize_ex()"})," accepts configuration options to customize loader behavior:"]}),"\n",(0,a.jsx)(e.p,{children:"This allows you to pass language-specific configuration options to each loader during initialization."}),"\n",(0,a.jsx)(e.h3,{id:"command-line-arguments",children:"Command-line Arguments"}),"\n",(0,a.jsx)(e.p,{children:"When running MetaCall as an application, you can pass command-line arguments using:"}),"\n",(0,a.jsx)(e.p,{children:"These arguments are available to the runtimes that may need them."}),"\n",(0,a.jsx)(e.h3,{id:"auto-initialization-mechanism",children:"Auto-initialization Mechanism"}),"\n",(0,a.jsx)(e.p,{children:"MetaCall employs a constructor mechanism that automatically initializes when loaded as a library:"}),"\n",(0,a.jsx)(e.h2,{id:"nodejs-initialization",children:"Node.js Initialization"}),"\n",(0,a.jsx)(e.p,{children:"The Node.js port demonstrates how initialization works in a language-specific context:"}),"\n",(0,a.jsx)(e.h2,{id:"shutdown-process",children:"Shutdown Process"}),"\n",(0,a.jsx)(e.p,{children:"Proper shutdown is essential to avoid resource leaks. The shutdown process typically follows this sequence:"}),"\n",(0,a.jsx)(e.h2,{id:"loader-initialization-and-destruction",children:"Loader Initialization and Destruction"}),"\n",(0,a.jsx)(e.p,{children:"Loaders are initialized in a specific order and then destroyed in reverse order (LIFO) to ensure proper dependency handling:"}),"\n",(0,a.jsx)(e.h2,{id:"checking-initialization-status",children:"Checking Initialization Status"}),"\n",(0,a.jsx)(e.p,{children:"You can check if MetaCall or a specific loader is initialized using:"}),"\n",(0,a.jsx)(e.h2,{id:"settings-flags-during-initialization",children:"Settings Flags During Initialization"}),"\n",(0,a.jsx)(e.p,{children:"MetaCall supports various flags that can be set before initialization:"}),"\n",(0,a.jsx)(e.h2,{id:"initialization-and-shutdown-in-cc",children:"Initialization and Shutdown in C/C++"}),"\n",(0,a.jsx)(e.p,{children:"Example of proper initialization and shutdown in C/C++:"}),"\n",(0,a.jsx)(e.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,a.jsxs)(e.ol,{children:["\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"Always check initialization result"}),": MetaCall functions return 0 on success and non-zero on error."]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"Register shutdown handlers"}),": In many contexts, you can register ",(0,a.jsx)(e.code,{children:"metacall_destroy()"})," with ",(0,a.jsx)(e.code,{children:"atexit()"})," to ensure resources are cleaned up."]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"Handle host environments"}),": When integrating MetaCall with an existing language runtime, use the host environment configuration:"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"Initialize once"}),": MetaCall has protections against multiple initializations, but it's still good practice to check before initializing:"]}),"\n",(0,a.jsxs)(e.li,{children:[(0,a.jsx)(e.strong,{children:"Loader-specific path initialization"}),": Set execution paths for loaders before loading code:"]}),"\n"]}),"\n",(0,a.jsx)(e.h2,{id:"lifecycle-diagram",children:"Lifecycle Diagram"}),"\n",(0,a.jsx)(e.p,{children:"The complete lifecycle of a MetaCall application follows this pattern:"}),"\n",(0,a.jsx)(e.h2,{id:"value-validation-during-operations",children:"Value Validation During Operations"}),"\n",(0,a.jsx)(e.p,{children:"MetaCall checks value validity during operations to detect potential memory corruption or use-after-free scenarios:"}),"\n",(0,a.jsx)(e.h2,{id:"troubleshooting-initialization-issues",children:"Troubleshooting Initialization Issues"}),"\n",(0,a.jsx)(e.p,{children:"Common initialization issues and solutions:"}),"\n",(0,a.jsxs)(e.table,{children:[(0,a.jsx)(e.thead,{children:(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.th,{children:"Issue"}),(0,a.jsx)(e.th,{children:"Possible Cause"}),(0,a.jsx)(e.th,{children:"Solution"})]})}),(0,a.jsxs)(e.tbody,{children:[(0,a.jsxs)(e.tr,{children:[(0,a.jsxs)(e.td,{children:["Function returns ",(0,a.jsx)(e.code,{children:"NULL"})]}),(0,a.jsx)(e.td,{children:"MetaCall not initialized"}),(0,a.jsxs)(e.td,{children:["Call ",(0,a.jsx)(e.code,{children:"metacall_initialize()"})," before using MetaCall functions"]})]}),(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.td,{children:"Loader fails to initialize"}),(0,a.jsx)(e.td,{children:"Missing dependencies"}),(0,a.jsx)(e.td,{children:"Check if language runtime is properly installed"})]}),(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.td,{children:"Memory leaks"}),(0,a.jsxs)(e.td,{children:["Missing ",(0,a.jsx)(e.code,{children:"metacall_destroy()"})]}),(0,a.jsxs)(e.td,{children:["Ensure proper shutdown or register with ",(0,a.jsx)(e.code,{children:"atexit()"})]})]}),(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.td,{children:"Crashes during initialization"}),(0,a.jsx)(e.td,{children:"Conflicting runtimes"}),(0,a.jsxs)(e.td,{children:["Use ",(0,a.jsx)(e.code,{children:"METACALL_HOST"})," environment variable"]})]}),(0,a.jsxs)(e.tr,{children:[(0,a.jsx)(e.td,{children:"File loading errors"}),(0,a.jsx)(e.td,{children:"Incorrect execution path"}),(0,a.jsxs)(e.td,{children:["Set correct path with ",(0,a.jsx)(e.code,{children:"metacall_execution_path()"})]})]}),(0,a.jsxs)(e.tr,{children:[(0,a.jsxs)(e.td,{children:["Sources: ",(0,a.jsx)(e.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/metacall/source/metacall.c#L222-L341",children:"source/metacall/source/metacall.c222-341"})," ",(0,a.jsx)(e.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loader/source/loader_impl.c#L391-L511",children:"source/loader/source/loader_impl.c391-511"})]}),(0,a.jsx)(e.td,{}),(0,a.jsx)(e.td,{})]})]})]})]})}function h(i={}){const{wrapper:e}={...(0,l.R)(),...i.components};return e?(0,a.jsx)(e,{...i,children:(0,a.jsx)(d,{...i})}):d(i)}},8453:(i,e,n)=>{n.d(e,{R:()=>s,x:()=>o});var t=n(6540);const a={},l=t.createContext(a);function s(i){const e=t.useContext(l);return t.useMemo(function(){return"function"==typeof i?i(e):{...e,...i}},[e,i])}function o(i){let e;return e=i.disableParentContext?"function"==typeof i.components?i.components(a):i.components||a:s(i.components),t.createElement(l.Provider,{value:e},i.children)}}}]);