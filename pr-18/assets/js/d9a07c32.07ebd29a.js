"use strict";(globalThis.webpackChunkmetacall_doc=globalThis.webpackChunkmetacall_doc||[]).push([[1788],{7736:(e,r,l)=>{l.r(r),l.d(r,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>t});const s=JSON.parse('{"id":"metacall-core/ruby-loader","title":"Ruby Loader","description":"The Ruby Loader is a plugin for MetaCall Core that enables loading, executing, and interfacing with Ruby code at runtime. This component allows Ruby functions, objects, and classes to be called from other programming languages supported by MetaCall, and vice versa.","source":"@site/docs/metacall-core/ruby-loader.md","sourceDirName":"metacall-core","slug":"/metacall-core/ruby-loader","permalink":"/doc/pr-18/docs/metacall-core/ruby-loader","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Ruby Loader"},"sidebar":"tutorialSidebar","previous":{"title":"REPL Mode","permalink":"/doc/pr-18/docs/metacall-core/repl-mode"},"next":{"title":"Ruby Port","permalink":"/doc/pr-18/docs/metacall-core/ruby-port"}}');var i=l(4848),n=l(8453);const o={title:"Ruby Loader"},a="Ruby Loader",c={},t=[{value:"Architecture",id:"architecture",level:2},{value:"Ruby Loader Components",id:"ruby-loader-components",level:3},{value:"Loading and Execution Flow",id:"loading-and-execution-flow",level:3},{value:"Initialization",id:"initialization",level:2},{value:"Type Conversion System",id:"type-conversion-system",level:2},{value:"Loading Ruby Code",id:"loading-ruby-code",level:2},{value:"Loading from Files",id:"loading-from-files",level:3},{value:"Loading from Memory",id:"loading-from-memory",level:3},{value:"Function Invocation",id:"function-invocation",level:2},{value:"Object and Class Support",id:"object-and-class-support",level:2},{value:"Object Interface",id:"object-interface",level:3},{value:"Class Interface",id:"class-interface",level:3},{value:"Initialization of Types",id:"initialization-of-types",level:3},{value:"Error Handling",id:"error-handling",level:2},{value:"Build Dependencies",id:"build-dependencies",level:2},{value:"Usage Examples",id:"usage-examples",level:2},{value:"Loading Ruby Code",id:"loading-ruby-code-1",level:3},{value:"Working with Ruby Objects",id:"working-with-ruby-objects",level:3},{value:"Working with Ruby Classes",id:"working-with-ruby-classes",level:3}];function d(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,n.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"ruby-loader",children:"Ruby Loader"})}),"\n",(0,i.jsx)(r.p,{children:"The Ruby Loader is a plugin for MetaCall Core that enables loading, executing, and interfacing with Ruby code at runtime. This component allows Ruby functions, objects, and classes to be called from other programming languages supported by MetaCall, and vice versa."}),"\n",(0,i.jsx)(r.h2,{id:"architecture",children:"Architecture"}),"\n",(0,i.jsx)(r.p,{children:"The Ruby Loader follows the standard loader architecture of MetaCall, implementing Ruby-specific capabilities to bridge the Ruby interpreter with the MetaCall reflection system."}),"\n",(0,i.jsx)(r.h3,{id:"ruby-loader-components",children:"Ruby Loader Components"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/rb_loader/source/rb_loader_impl.c#L149-L600",children:"source/loaders/rb_loader/source/rb_loader_impl.c149-600"})}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/rb_loader/source/rb_loader_impl.c#L602-L754",children:"source/loaders/rb_loader/source/rb_loader_impl.c602-754"})}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/rb_loader/source/rb_loader_impl.c#L756-L936",children:"source/loaders/rb_loader/source/rb_loader_impl.c756-936"})}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"loading-and-execution-flow",children:"Loading and Execution Flow"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/rb_loader/source/rb_loader_impl.c#L977-L1040",children:"source/loaders/rb_loader/source/rb_loader_impl.c977-1040"})}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/rb_loader/source/rb_loader_impl.c#L1228-L1285",children:"source/loaders/rb_loader/source/rb_loader_impl.c1228-1285"})}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/rb_loader/source/rb_loader_impl.c#L397-L554",children:"source/loaders/rb_loader/source/rb_loader_impl.c397-554"})}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"initialization",children:"Initialization"}),"\n",(0,i.jsx)(r.p,{children:"When the Ruby Loader is initialized, it performs the following operations:"}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsxs)(r.li,{children:["Initializes the Ruby interpreter with ",(0,i.jsx)(r.code,{children:"ruby_sysinit()"})," and ",(0,i.jsx)(r.code,{children:"ruby_init()"})]}),"\n",(0,i.jsxs)(r.li,{children:["Sets up the Ruby load path with ",(0,i.jsx)(r.code,{children:"ruby_init_loadpath()"})]}),"\n",(0,i.jsx)(r.li,{children:"Initializes the type system to map between Ruby and MetaCall types"}),"\n",(0,i.jsx)(r.li,{children:"Registers the loader with the MetaCall system"}),"\n"]}),"\n",(0,i.jsxs)(r.p,{children:["The initialization code can be found in the ",(0,i.jsx)(r.code,{children:"rb_loader_impl_initialize"})," function:"]}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/rb_loader/source/rb_loader_impl.c#L977-L1040",children:"source/loaders/rb_loader/source/rb_loader_impl.c977-1040"})}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"type-conversion-system",children:"Type Conversion System"}),"\n",(0,i.jsx)(r.p,{children:"The Ruby Loader implements a comprehensive type conversion system to translate between Ruby types and MetaCall's type system. This conversion is handled by two main functions:"}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"rb_type_deserialize"}),": Converts Ruby values to MetaCall values"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"rb_type_serialize"}),": Converts MetaCall values to Ruby values"]}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"The type mapping is as follows:"}),"\n",(0,i.jsxs)(r.table,{children:[(0,i.jsx)(r.thead,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.th,{children:"Ruby Type"}),(0,i.jsx)(r.th,{children:"MetaCall Type"})]})}),(0,i.jsxs)(r.tbody,{children:[(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"T_TRUE/T_FALSE"}),(0,i.jsx)(r.td,{children:"BOOL"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"T_FIXNUM"}),(0,i.jsx)(r.td,{children:"INT"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"T_BIGNUM"}),(0,i.jsx)(r.td,{children:"LONG"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"T_FLOAT"}),(0,i.jsx)(r.td,{children:"DOUBLE"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"T_STRING"}),(0,i.jsx)(r.td,{children:"STRING"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"T_ARRAY"}),(0,i.jsx)(r.td,{children:"ARRAY"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"T_NIL"}),(0,i.jsx)(r.td,{children:"NULL"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"T_OBJECT"}),(0,i.jsx)(r.td,{children:"OBJECT"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"T_CLASS"}),(0,i.jsx)(r.td,{children:"CLASS"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"For example, here's how a Ruby string is converted to a MetaCall string:"}),(0,i.jsx)(r.td,{})]})]})]}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/rb_loader/source/rb_loader_impl.c#L166-L307",children:"source/loaders/rb_loader/source/rb_loader_impl.c166-307"})}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/rb_loader/source/rb_loader_impl.c#L309-L354",children:"source/loaders/rb_loader/source/rb_loader_impl.c309-354"})}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"loading-ruby-code",children:"Loading Ruby Code"}),"\n",(0,i.jsx)(r.p,{children:"The Ruby Loader supports loading Ruby code from files, memory, or packages. Two main methods are implemented:"}),"\n",(0,i.jsx)(r.h3,{id:"loading-from-files",children:"Loading from Files"}),"\n",(0,i.jsxs)(r.p,{children:["The ",(0,i.jsx)(r.code,{children:"rb_loader_impl_load_from_file"})," function loads Ruby code from files:"]}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsx)(r.li,{children:"Creates a handle to manage the loaded modules"}),"\n",(0,i.jsxs)(r.li,{children:["For each file path, it:","\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Extracts the module name from the path"}),"\n",(0,i.jsxs)(r.li,{children:["Loads the Ruby module with ",(0,i.jsx)(r.code,{children:"rb_loader_impl_load_from_file_module"})]}),"\n",(0,i.jsx)(r.li,{children:"Adds the module to the handle's module vector"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(r.li,{children:"Returns the handle to the MetaCall system"}),"\n"]}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/rb_loader/source/rb_loader_impl.c#L1228-L1285",children:"source/loaders/rb_loader/source/rb_loader_impl.c1228-1285"})}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"loading-from-memory",children:"Loading from Memory"}),"\n",(0,i.jsxs)(r.p,{children:["The ",(0,i.jsx)(r.code,{children:"rb_loader_impl_load_from_memory"})," function loads Ruby code from a memory buffer:"]}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsx)(r.li,{children:"Creates a handle to manage the loaded module"}),"\n",(0,i.jsxs)(r.li,{children:["Loads the Ruby module using ",(0,i.jsx)(r.code,{children:"rb_loader_impl_load_from_memory_module"})]}),"\n",(0,i.jsx)(r.li,{children:"Adds the module to the handle's module vector"}),"\n",(0,i.jsx)(r.li,{children:"Returns the handle to the MetaCall system"}),"\n"]}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/rb_loader/source/rb_loader_impl.c#L1356-L1396",children:"source/loaders/rb_loader/source/rb_loader_impl.c1356-1396"})}),"\n"]}),"\n",(0,i.jsxs)(r.p,{children:["Both loading methods use a parser (",(0,i.jsx)(r.code,{children:"rb_loader_impl_key_parse"}),") to identify Ruby functions that can be called from other languages:"]}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/rb_loader/source/rb_loader_impl_parser.c#L53-L2112",children:"source/loaders/rb_loader/source/rb_loader_impl_parser.c53-2112"})}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"function-invocation",children:"Function Invocation"}),"\n",(0,i.jsxs)(r.p,{children:["When a Ruby function is called through MetaCall, the ",(0,i.jsx)(r.code,{children:"function_rb_interface_invoke"})," function handles the invocation:"]}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsx)(r.li,{children:"Converts MetaCall arguments to Ruby values"}),"\n",(0,i.jsxs)(r.li,{children:["Determines the invocation strategy:","\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Typed: Using keyword arguments"}),"\n",(0,i.jsx)(r.li,{children:"Duck-typed: Using positional arguments"}),"\n",(0,i.jsx)(r.li,{children:"Mixed: A combination of both"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(r.li,{children:"Calls the Ruby function using the appropriate strategy"}),"\n",(0,i.jsx)(r.li,{children:"Captures any Ruby exceptions that occur"}),"\n",(0,i.jsx)(r.li,{children:"Converts the Ruby result back to a MetaCall value"}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"The function supports three invocation strategies based on whether the function's signature is defined with named arguments:"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/rb_loader/source/rb_loader_impl.c#L397-L554",children:"source/loaders/rb_loader/source/rb_loader_impl.c397-554"})}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"object-and-class-support",children:"Object and Class Support"}),"\n",(0,i.jsx)(r.p,{children:"The Ruby Loader provides comprehensive support for working with Ruby objects and classes through the following interfaces:"}),"\n",(0,i.jsx)(r.h3,{id:"object-interface",children:"Object Interface"}),"\n",(0,i.jsx)(r.p,{children:"The object interface enables interacting with Ruby objects:"}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"rb_object_interface_get"}),": Retrieves object attributes"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"rb_object_interface_set"}),": Sets object attributes"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"rb_object_interface_method_invoke"}),": Calls object methods"]}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"For example, retrieving an object attribute:"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/rb_loader/source/rb_loader_impl.c#L602-L754",children:"source/loaders/rb_loader/source/rb_loader_impl.c602-754"})}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"class-interface",children:"Class Interface"}),"\n",(0,i.jsx)(r.p,{children:"The class interface enables working with Ruby classes:"}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"rb_class_interface_constructor"}),": Creates new class instances"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"rb_class_interface_static_get"}),": Retrieves class static attributes"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"rb_class_interface_static_set"}),": Sets class static attributes"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"rb_class_interface_static_invoke"}),": Calls class static methods"]}),"\n"]}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/rb_loader/source/rb_loader_impl.c#L756-L936",children:"source/loaders/rb_loader/source/rb_loader_impl.c756-936"})}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"initialization-of-types",children:"Initialization of Types"}),"\n",(0,i.jsx)(r.p,{children:"The Ruby Loader initializes the type system to map between Ruby types and MetaCall types:"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/rb_loader/source/rb_loader_impl.c#L938-L975",children:"source/loaders/rb_loader/source/rb_loader_impl.c938-975"})}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,i.jsx)(r.p,{children:"The Ruby Loader includes error handling to capture Ruby exceptions during code execution:"}),"\n",(0,i.jsx)(r.p,{children:"This macro is used throughout the code to handle Ruby exceptions and log them appropriately."}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/rb_loader/source/rb_loader_impl.c#L381-L395",children:"source/loaders/rb_loader/source/rb_loader_impl.c381-395"})}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"build-dependencies",children:"Build Dependencies"}),"\n",(0,i.jsx)(r.p,{children:"The Ruby Loader has the following build dependencies:"}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsx)(r.li,{children:"Ruby development libraries and headers"}),"\n",(0,i.jsx)(r.li,{children:"MetaCall Core libraries"}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:"These dependencies are configured in the CMakeLists.txt file:"}),"\n",(0,i.jsx)(r.p,{children:"On Windows platforms, the Ruby DLL is copied to the output directory to ensure proper runtime loading."}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/rb_loader/CMakeLists.txt#L1-L219",children:"source/loaders/rb_loader/CMakeLists.txt1-219"})}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"usage-examples",children:"Usage Examples"}),"\n",(0,i.jsx)(r.h3,{id:"loading-ruby-code-1",children:"Loading Ruby Code"}),"\n",(0,i.jsx)(r.h3,{id:"working-with-ruby-objects",children:"Working with Ruby Objects"}),"\n",(0,i.jsx)(r.h3,{id:"working-with-ruby-classes",children:"Working with Ruby Classes"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/tests/metacall_ruby_object_class_test/source/metacall_ruby_object_class_test.cpp#L32-L164",children:"source/tests/metacall_ruby_object_class_test/source/metacall_ruby_object_class_test.cpp32-164"})}),"\n",(0,i.jsx)(r.li,{children:(0,i.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/scripts/ruby/klass/source/klass.rb#L1-L45",children:"source/scripts/ruby/klass/source/klass.rb1-45"})}),"\n"]})]})}function h(e={}){const{wrapper:r}={...(0,n.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,r,l)=>{l.d(r,{R:()=>o,x:()=>a});var s=l(6540);const i={},n=s.createContext(i);function o(e){const r=s.useContext(n);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(n.Provider,{value:r},e.children)}}}]);