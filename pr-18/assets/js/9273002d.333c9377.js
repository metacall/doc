"use strict";(globalThis.webpackChunkmetacall_doc=globalThis.webpackChunkmetacall_doc||[]).push([[7254],{4595:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>s,default:()=>h,frontMatter:()=>r,metadata:()=>l,toc:()=>o});const l=JSON.parse('{"id":"metacall-core/core-api","title":"Core API","description":"The MetaCall Core API provides the fundamental interface for interoperating between different programming languages. It enables loading code from various languages, executing functions across language boundaries, and handling data conversion between different type systems.","source":"@site/docs/metacall-core/core-api.md","sourceDirName":"metacall-core","slug":"/metacall-core/core-api","permalink":"/doc/pr-18/docs/metacall-core/core-api","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Core API"},"sidebar":"tutorialSidebar","previous":{"title":"Command Line Interface","permalink":"/doc/pr-18/docs/metacall-core/command-line-interface"},"next":{"title":"Core Components","permalink":"/doc/pr-18/docs/metacall-core/core-components"}}');var a=i(4848),t=i(8453);const r={title:"Core API"},s="Core API",d={},o=[{value:"Core API Architecture",id:"core-api-architecture",level:2},{value:"API Workflow",id:"api-workflow",level:2},{value:"1. Initialization API",id:"1-initialization-api",level:2},{value:"Basic Initialization",id:"basic-initialization",level:3},{value:"Advanced Initialization",id:"advanced-initialization",level:3},{value:"Command-line Arguments",id:"command-line-arguments",level:3},{value:"Checking Initialization Status",id:"checking-initialization-status",level:3},{value:"2. Loading Code API",id:"2-loading-code-api",level:2},{value:"Loading from Files",id:"loading-from-files",level:3},{value:"Loading from Memory",id:"loading-from-memory",level:3},{value:"Loading from Package",id:"loading-from-package",level:3},{value:"Loading from Configuration",id:"loading-from-configuration",level:3},{value:"Setting Execution Paths",id:"setting-execution-paths",level:3},{value:"3. Function Calling API",id:"3-function-calling-api",level:2},{value:"Basic Function Call",id:"basic-function-call",level:3},{value:"Vector-Based Function Call",id:"vector-based-function-call",level:3},{value:"Typed Function Call",id:"typed-function-call",level:3},{value:"Handle-Specific Function Call",id:"handle-specific-function-call",level:3},{value:"Function References",id:"function-references",level:3},{value:"Function Introspection",id:"function-introspection",level:3},{value:"4. Value System",id:"4-value-system",level:2},{value:"Value Types",id:"value-types",level:3},{value:"Creating Values",id:"creating-values",level:3},{value:"Converting Values",id:"converting-values",level:3},{value:"Value Operations",id:"value-operations",level:3},{value:"5. Serialization",id:"5-serialization",level:2},{value:"Serializing Values",id:"serializing-values",level:3},{value:"Deserializing Values",id:"deserializing-values",level:3},{value:"6. Error Handling",id:"6-error-handling",level:2},{value:"Checking for Errors",id:"checking-for-errors",level:3},{value:"Using Throwable Values",id:"using-throwable-values",level:3},{value:"7. Memory Management",id:"7-memory-management",level:2},{value:"Value Lifecycle",id:"value-lifecycle",level:3},{value:"Custom Allocators",id:"custom-allocators",level:3},{value:"8. Advanced Features",id:"8-advanced-features",level:2},{value:"Function Registration",id:"function-registration",level:3},{value:"Handle Management",id:"handle-management",level:3},{value:"Inspecting Loaded Code",id:"inspecting-loaded-code",level:3},{value:"9. Shutdown",id:"9-shutdown",level:2},{value:"Type System Relationships",id:"type-system-relationships",level:2},{value:"Function Call Flow",id:"function-call-flow",level:2},{value:"Example Usage",id:"example-usage",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"core-api",children:"Core API"})}),"\n",(0,a.jsxs)(n.p,{children:["The MetaCall Core API provides the fundamental interface for interoperating between different programming languages. It enables loading code from various languages, executing functions across language boundaries, and handling data conversion between different type systems.\nThis page documents the C API that serves as the foundation for all MetaCall functionality. For language-specific ports that provide native bindings, see ",(0,a.jsx)(n.a,{href:"/doc/pr-18/docs/metacall-core/ports",children:"Ports"}),"."]}),"\n",(0,a.jsx)(n.h2,{id:"core-api-architecture",children:"Core API Architecture"}),"\n",(0,a.jsx)(n.h2,{id:"api-workflow",children:"API Workflow"}),"\n",(0,a.jsx)(n.h2,{id:"1-initialization-api",children:"1. Initialization API"}),"\n",(0,a.jsx)(n.p,{children:"Before using any MetaCall functionality, the library must be initialized."}),"\n",(0,a.jsx)(n.h3,{id:"basic-initialization",children:"Basic Initialization"}),"\n",(0,a.jsx)(n.p,{children:"This initializes the MetaCall runtime with default settings. Returns 0 on success, non-zero on failure."}),"\n",(0,a.jsx)(n.h3,{id:"advanced-initialization",children:"Advanced Initialization"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"options_value"})," must be a MetaCall map value containing configuration options for the specified loader."]}),"\n",(0,a.jsx)(n.h3,{id:"command-line-arguments",children:"Command-line Arguments"}),"\n",(0,a.jsx)(n.p,{children:"For applications that need to pass command-line arguments to language runtimes:"}),"\n",(0,a.jsx)(n.h3,{id:"checking-initialization-status",children:"Checking Initialization Status"}),"\n",(0,a.jsx)(n.h2,{id:"2-loading-code-api",children:"2. Loading Code API"}),"\n",(0,a.jsx)(n.p,{children:"MetaCall provides multiple ways to load code from different sources."}),"\n",(0,a.jsx)(n.h3,{id:"loading-from-files",children:"Loading from Files"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"tag"}),' parameter ("py" in this example) specifies the language loader to use. Supported tags include:']}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:'"py" for Python'}),"\n",(0,a.jsx)(n.li,{children:'"node" or "js" for JavaScript (Node.js)'}),"\n",(0,a.jsx)(n.li,{children:'"rb" for Ruby'}),"\n",(0,a.jsx)(n.li,{children:'"cs" for C#'}),"\n",(0,a.jsx)(n.li,{children:'"c" for C'}),"\n",(0,a.jsx)(n.li,{children:'"java" for Java'}),"\n",(0,a.jsx)(n.li,{children:'"ts" for TypeScript'}),"\n",(0,a.jsx)(n.li,{children:'"file" for static files'}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"handle"})," parameter is optional:"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"If NULL, functions are loaded into the global scope"}),"\n",(0,a.jsx)(n.li,{children:"If a pointer to NULL, a new handle is created for the loaded code"}),"\n",(0,a.jsx)(n.li,{children:"If a pointer to an existing handle, functions are added to that handle"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"loading-from-memory",children:"Loading from Memory"}),"\n",(0,a.jsx)(n.h3,{id:"loading-from-package",children:"Loading from Package"}),"\n",(0,a.jsx)(n.h3,{id:"loading-from-configuration",children:"Loading from Configuration"}),"\n",(0,a.jsx)(n.p,{children:"The configuration file format is:"}),"\n",(0,a.jsx)(n.h3,{id:"setting-execution-paths",children:"Setting Execution Paths"}),"\n",(0,a.jsx)(n.p,{children:"Before loading code, you can define execution paths for the loader to search for imports:"}),"\n",(0,a.jsx)(n.h2,{id:"3-function-calling-api",children:"3. Function Calling API"}),"\n",(0,a.jsx)(n.p,{children:"MetaCall offers several ways to call functions across language boundaries."}),"\n",(0,a.jsx)(n.h3,{id:"basic-function-call",children:"Basic Function Call"}),"\n",(0,a.jsx)(n.p,{children:"The arguments are automatically converted to appropriate MetaCall values based on their C types."}),"\n",(0,a.jsx)(n.h3,{id:"vector-based-function-call",children:"Vector-Based Function Call"}),"\n",(0,a.jsx)(n.h3,{id:"typed-function-call",children:"Typed Function Call"}),"\n",(0,a.jsx)(n.h3,{id:"handle-specific-function-call",children:"Handle-Specific Function Call"}),"\n",(0,a.jsx)(n.p,{children:"When using handles to avoid name collisions:"}),"\n",(0,a.jsx)(n.h3,{id:"function-references",children:"Function References"}),"\n",(0,a.jsx)(n.p,{children:"For repeated calls to the same function:"}),"\n",(0,a.jsx)(n.p,{children:"For handle-specific function references:"}),"\n",(0,a.jsx)(n.h3,{id:"function-introspection",children:"Function Introspection"}),"\n",(0,a.jsx)(n.h2,{id:"4-value-system",children:"4. Value System"}),"\n",(0,a.jsx)(n.p,{children:"The MetaCall value system provides a common representation for data across language boundaries."}),"\n",(0,a.jsx)(n.h3,{id:"value-types",children:"Value Types"}),"\n",(0,a.jsx)(n.p,{children:"MetaCall supports the following value types:"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Value Type ID"}),(0,a.jsx)(n.th,{children:"C Type"}),(0,a.jsx)(n.th,{children:"Description"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"METACALL_BOOL"}),(0,a.jsx)(n.td,{children:"boolean"}),(0,a.jsx)(n.td,{children:"Boolean value (0 or 1)"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"METACALL_CHAR"}),(0,a.jsx)(n.td,{children:"char"}),(0,a.jsx)(n.td,{children:"Single character"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"METACALL_SHORT"}),(0,a.jsx)(n.td,{children:"short"}),(0,a.jsx)(n.td,{children:"Short integer"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"METACALL_INT"}),(0,a.jsx)(n.td,{children:"int"}),(0,a.jsx)(n.td,{children:"Integer"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"METACALL_LONG"}),(0,a.jsx)(n.td,{children:"long"}),(0,a.jsx)(n.td,{children:"Long integer"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"METACALL_FLOAT"}),(0,a.jsx)(n.td,{children:"float"}),(0,a.jsx)(n.td,{children:"Single-precision floating point"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"METACALL_DOUBLE"}),(0,a.jsx)(n.td,{children:"double"}),(0,a.jsx)(n.td,{children:"Double-precision floating point"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"METACALL_STRING"}),(0,a.jsx)(n.td,{children:"char*"}),(0,a.jsx)(n.td,{children:"Null-terminated string"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"METACALL_BUFFER"}),(0,a.jsx)(n.td,{children:"void*"}),(0,a.jsx)(n.td,{children:"Binary data buffer"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"METACALL_ARRAY"}),(0,a.jsx)(n.td,{children:"void**"}),(0,a.jsx)(n.td,{children:"Array of values"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"METACALL_MAP"}),(0,a.jsx)(n.td,{children:"void**"}),(0,a.jsx)(n.td,{children:"Key-value pairs"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"METACALL_PTR"}),(0,a.jsx)(n.td,{children:"void*"}),(0,a.jsx)(n.td,{children:"Opaque pointer"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"METACALL_FUNCTION"}),(0,a.jsx)(n.td,{children:"void*"}),(0,a.jsx)(n.td,{children:"Function reference"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"METACALL_NULL"}),(0,a.jsx)(n.td,{children:"NULL"}),(0,a.jsx)(n.td,{children:"Null value"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"METACALL_CLASS"}),(0,a.jsx)(n.td,{children:"void*"}),(0,a.jsx)(n.td,{children:"Class definition"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"METACALL_OBJECT"}),(0,a.jsx)(n.td,{children:"void*"}),(0,a.jsx)(n.td,{children:"Object instance"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"METACALL_EXCEPTION"}),(0,a.jsx)(n.td,{children:"void*"}),(0,a.jsx)(n.td,{children:"Exception"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"METACALL_THROWABLE"}),(0,a.jsx)(n.td,{children:"void*"}),(0,a.jsx)(n.td,{children:"Value with exception"})]})]})]}),"\n",(0,a.jsx)(n.h3,{id:"creating-values",children:"Creating Values"}),"\n",(0,a.jsx)(n.h3,{id:"converting-values",children:"Converting Values"}),"\n",(0,a.jsx)(n.h3,{id:"value-operations",children:"Value Operations"}),"\n",(0,a.jsx)(n.h2,{id:"5-serialization",children:"5. Serialization"}),"\n",(0,a.jsx)(n.p,{children:"MetaCall provides serialization capabilities for converting values to and from string representations."}),"\n",(0,a.jsx)(n.h3,{id:"serializing-values",children:"Serializing Values"}),"\n",(0,a.jsx)(n.h3,{id:"deserializing-values",children:"Deserializing Values"}),"\n",(0,a.jsx)(n.p,{children:"The default serialization format is RapidJSON, accessed via:"}),"\n",(0,a.jsx)(n.h2,{id:"6-error-handling",children:"6. Error Handling"}),"\n",(0,a.jsx)(n.p,{children:"MetaCall provides error handling mechanisms for dealing with exceptions and errors that occur during cross-language calls."}),"\n",(0,a.jsx)(n.h3,{id:"checking-for-errors",children:"Checking for Errors"}),"\n",(0,a.jsx)(n.h3,{id:"using-throwable-values",children:"Using Throwable Values"}),"\n",(0,a.jsx)(n.h2,{id:"7-memory-management",children:"7. Memory Management"}),"\n",(0,a.jsx)(n.p,{children:"Proper memory management is critical when using the MetaCall Core API."}),"\n",(0,a.jsx)(n.h3,{id:"value-lifecycle",children:"Value Lifecycle"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["Values created with ",(0,a.jsx)(n.code,{children:"metacall_value_create_*"})," functions must be explicitly destroyed with ",(0,a.jsx)(n.code,{children:"metacall_value_destroy"})]}),"\n",(0,a.jsxs)(n.li,{children:["Values returned from ",(0,a.jsx)(n.code,{children:"metacall"})," and related functions must also be destroyed"]}),"\n",(0,a.jsx)(n.li,{children:"Values borrowed from arrays or maps should not be destroyed individually"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"custom-allocators",children:"Custom Allocators"}),"\n",(0,a.jsx)(n.p,{children:"MetaCall allows using custom allocators for serialization and deserialization:"}),"\n",(0,a.jsx)(n.h2,{id:"8-advanced-features",children:"8. Advanced Features"}),"\n",(0,a.jsx)(n.h3,{id:"function-registration",children:"Function Registration"}),"\n",(0,a.jsx)(n.p,{children:"Register C functions to be callable from other languages:"}),"\n",(0,a.jsx)(n.h3,{id:"handle-management",children:"Handle Management"}),"\n",(0,a.jsx)(n.p,{children:"Create and manage handles to isolate loaded code:"}),"\n",(0,a.jsx)(n.h3,{id:"inspecting-loaded-code",children:"Inspecting Loaded Code"}),"\n",(0,a.jsx)(n.h2,{id:"9-shutdown",children:"9. Shutdown"}),"\n",(0,a.jsx)(n.p,{children:"When you're finished using MetaCall, properly clean up resources:"}),"\n",(0,a.jsx)(n.p,{children:"This function:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Unloads all loaded code"}),"\n",(0,a.jsx)(n.li,{children:"Destroys all loaders and handles"}),"\n",(0,a.jsx)(n.li,{children:"Cleans up all allocated resources"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"type-system-relationships",children:"Type System Relationships"}),"\n",(0,a.jsx)(n.h2,{id:"function-call-flow",children:"Function Call Flow"}),"\n",(0,a.jsx)(n.h2,{id:"example-usage",children:"Example Usage"}),"\n",(0,a.jsx)(n.p,{children:"Simple Python function call from C:"}),"\n",(0,a.jsxs)(n.p,{children:["Sources: ",(0,a.jsx)(n.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/tests/metacall_test/source/metacall_test.cpp#L161-L179",children:"source/tests/metacall_test/source/metacall_test.cpp161-179"})]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>s});var l=i(6540);const a={},t=l.createContext(a);function r(e){const n=l.useContext(t);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),l.createElement(t.Provider,{value:n},e.children)}}}]);