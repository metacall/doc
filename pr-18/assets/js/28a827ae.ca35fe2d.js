"use strict";(globalThis.webpackChunkmetacall_doc=globalThis.webpackChunkmetacall_doc||[]).push([[1173],{6797:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"metacall-core/go-port","title":"Go Port","description":"The Go Port enables Go applications to interoperate with code written in other programming languages supported by MetaCall. This port provides a thin wrapper around the MetaCall C API, allowing Go developers to load and execute code written in Python, JavaScript, Ruby, and other languages directly from Go code.","source":"@site/docs/metacall-core/go-port.md","sourceDirName":"metacall-core","slug":"/metacall-core/go-port","permalink":"/doc/pr-18/docs/metacall-core/go-port","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Go Port"},"sidebar":"tutorialSidebar","previous":{"title":"Features and Capabilities","permalink":"/doc/pr-18/docs/metacall-core/features-and-capabilities"},"next":{"title":"Initialization and Shutdown","permalink":"/doc/pr-18/docs/metacall-core/initialization-and-shutdown"}}');var s=r(4848),t=r(8453);const l={title:"Go Port"},o="Go Port",d={},c=[{value:"1. Overview",id:"1-overview",level:2},{value:"2. Architecture",id:"2-architecture",level:2},{value:"2.1 Thread Safety",id:"21-thread-safety",level:3},{value:"3. Installation and Setup",id:"3-installation-and-setup",level:2},{value:"3.1 Prerequisites",id:"31-prerequisites",level:3},{value:"3.2 Go Module Installation",id:"32-go-module-installation",level:3},{value:"3.3 Environment Setup",id:"33-environment-setup",level:3},{value:"4. API Reference",id:"4-api-reference",level:2},{value:"4.1 Initialization and Shutdown",id:"41-initialization-and-shutdown",level:3},{value:"4.2 Loading Code",id:"42-loading-code",level:3},{value:"4.3 Calling Functions",id:"43-calling-functions",level:3},{value:"5. Type Conversion",id:"5-type-conversion",level:2},{value:"5.1 Go to MetaCall Conversion",id:"51-go-to-metacall-conversion",level:3},{value:"5.2 MetaCall to Go Conversion",id:"52-metacall-to-go-conversion",level:3},{value:"6. Working with Asynchronous Functions",id:"6-working-with-asynchronous-functions",level:2},{value:"7. Usage Examples",id:"7-usage-examples",level:2},{value:"7.1 Basic Usage",id:"71-basic-usage",level:3},{value:"7.2 Working with Async Functions",id:"72-working-with-async-functions",level:3},{value:"8. Thread Safety and Memory Management",id:"8-thread-safety-and-memory-management",level:2},{value:"8.1 Pointer Management",id:"81-pointer-management",level:3},{value:"8.2 Memory Safety",id:"82-memory-safety",level:3},{value:"9. Performance Considerations",id:"9-performance-considerations",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"go-port",children:"Go Port"})}),"\n",(0,s.jsxs)(n.p,{children:["The Go Port enables Go applications to interoperate with code written in other programming languages supported by MetaCall. This port provides a thin wrapper around the MetaCall C API, allowing Go developers to load and execute code written in Python, JavaScript, Ruby, and other languages directly from Go code.\nFor information about other language ports, see ",(0,s.jsx)(n.a,{href:"/doc/pr-18/docs/metacall-core/port-system",children:"Port System"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"1-overview",children:"1. Overview"}),"\n",(0,s.jsx)(n.p,{children:"The Go Port allows Go applications to:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Load code from other languages"}),"\n",(0,s.jsx)(n.li,{children:"Call functions defined in those languages"}),"\n",(0,s.jsx)(n.li,{children:"Handle async functions with promises"}),"\n",(0,s.jsx)(n.li,{children:"Convert values between Go and other programming languages"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"2-architecture",children:"2. Architecture"}),"\n",(0,s.jsx)(n.p,{children:"The Go Port uses CGO to interface with the MetaCall C API. It follows a thread-safe design to ensure that all calls to the MetaCall C API happen in a consistent environment."}),"\n",(0,s.jsx)(n.h3,{id:"21-thread-safety",children:"2.1 Thread Safety"}),"\n",(0,s.jsx)(n.p,{children:"The Go Port ensures thread safety by:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Running all MetaCall C API calls in a single goroutine"}),"\n",(0,s.jsx)(n.li,{children:"Using a channel-based work queue to dispatch operations"}),"\n",(0,s.jsx)(n.li,{children:"Locking the OS thread to maintain a consistent environment for the C API"}),"\n",(0,s.jsx)(n.li,{children:"Using synchronization primitives to coordinate operations"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"This approach prevents race conditions and ensures that MetaCall's internal state remains consistent."}),"\n",(0,s.jsx)(n.h2,{id:"3-installation-and-setup",children:"3. Installation and Setup"}),"\n",(0,s.jsx)(n.h3,{id:"31-prerequisites",children:"3.1 Prerequisites"}),"\n",(0,s.jsx)(n.p,{children:"Before using the Go Port, you must have MetaCall installed on your system."}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Build and install MetaCall from source, or"}),"\n",(0,s.jsx)(n.li,{children:"Install precompiled binaries"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"32-go-module-installation",children:"3.2 Go Module Installation"}),"\n",(0,s.jsx)(n.p,{children:"To use the Go Port in your Go application:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"go get github.com/metacall/core/source/ports/go_port/source\n"})}),"\n",(0,s.jsx)(n.h3,{id:"33-environment-setup",children:"3.3 Environment Setup"}),"\n",(0,s.jsx)(n.p,{children:"When using precompiled binaries on Linux, you may need to set the following environment variables:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'export CGO_CFLAGS="-I/gnu/store/`ls /gnu/store/ | grep metacall | head -n 1`/include"\nexport CGO_LDFLAGS="-L/gnu/store/`ls /gnu/store/ | grep metacall | head -n 1`/lib"\nexport LD_LIBRARY_PATH="/gnu/store/`ls /gnu/store/ | grep metacall | head -n 1`/lib"\n'})}),"\n",(0,s.jsx)(n.h2,{id:"4-api-reference",children:"4. API Reference"}),"\n",(0,s.jsx)(n.h3,{id:"41-initialization-and-shutdown",children:"4.1 Initialization and Shutdown"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Function"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Initialize()"})}),(0,s.jsx)(n.td,{children:"Initializes the MetaCall runtime and starts the worker goroutine"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Destroy()"})}),(0,s.jsx)(n.td,{children:"Shuts down the MetaCall runtime and stops the worker goroutine"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"42-loading-code",children:"4.2 Loading Code"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Function"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"LoadFromFile(tag string, scripts []string) error"})}),(0,s.jsx)(n.td,{children:"Loads code from file paths"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"LoadFromMemory(tag string, buffer string) error"})}),(0,s.jsx)(n.td,{children:"Loads code from a string buffer"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"Parameters:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"tag"}),': The language tag (e.g., "py", "node", "rb", "ts")']}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"scripts"}),": Array of script file paths or code string"]}),"\n",(0,s.jsx)(n.li,{children:"Returns an error if loading fails"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"43-calling-functions",children:"4.3 Calling Functions"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Function"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Call(function string, args ...interface{}) (interface{}, error)"})}),(0,s.jsx)(n.td,{children:"Calls a function with arguments"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Await(function string, resolve, reject awaitCallback, ctx interface{}, args ...interface{}) (interface{}, error)"})}),(0,s.jsx)(n.td,{children:"Calls an async function with callbacks"})]})]})]}),"\n",(0,s.jsx)(n.p,{children:"Parameters:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"function"}),": The function name to call"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"args"}),": Variable arguments to pass to the function"]}),"\n",(0,s.jsxs)(n.li,{children:["For ",(0,s.jsx)(n.code,{children:"Await"}),":","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"resolve"}),": Callback for successful completion"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"reject"}),": Callback for error handling"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ctx"}),": User context passed to callbacks"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"Returns the function result and any error"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"5-type-conversion",children:"5. Type Conversion"}),"\n",(0,s.jsx)(n.p,{children:"The Go Port handles type conversion between Go types and MetaCall value types."}),"\n",(0,s.jsx)(n.h3,{id:"51-go-to-metacall-conversion",children:"5.1 Go to MetaCall Conversion"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Go Type"}),(0,s.jsx)(n.th,{children:"MetaCall Type"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"nil"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Null"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"bool"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Bool"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"byte"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Char"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"int16"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Short"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"int"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Int"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"int64"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Long"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"float32"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Float"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"float64"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Double"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"string"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"String"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"bytes.Buffer"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Buffer"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"slice"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Array"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"array"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Array"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"map"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"Map"})})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"52-metacall-to-go-conversion",children:"5.2 MetaCall to Go Conversion"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"MetaCall Type"}),(0,s.jsx)(n.th,{children:"Go Type"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"METACALL_NULL"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"nil"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"METACALL_BOOL"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"bool"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"METACALL_CHAR"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"byte"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"METACALL_SHORT"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"int16"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"METACALL_INT"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"int"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"METACALL_LONG"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"int64"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"METACALL_FLOAT"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"float32"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"METACALL_DOUBLE"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"float64"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"METACALL_STRING"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"string"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"METACALL_BUFFER"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"bytes.Buffer"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"METACALL_ARRAY"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"[]interface{}"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"METACALL_MAP"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"map[string]interface{}"})})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"6-working-with-asynchronous-functions",children:"6. Working with Asynchronous Functions"}),"\n",(0,s.jsxs)(n.p,{children:["The Go Port supports calling asynchronous functions (like JavaScript promises) through the ",(0,s.jsx)(n.code,{children:"Await"})," function. This allows Go code to interact with asynchronous code from other languages."]}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"awaitCallback"})," type is defined as:"]}),"\n",(0,s.jsx)(n.p,{children:"Where:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"First parameter: Value from async function"}),"\n",(0,s.jsx)(n.li,{children:"Second parameter: User context"}),"\n",(0,s.jsx)(n.li,{children:"Return value: New value to pass back to MetaCall"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"7-usage-examples",children:"7. Usage Examples"}),"\n",(0,s.jsx)(n.h3,{id:"71-basic-usage",children:"7.1 Basic Usage"}),"\n",(0,s.jsx)(n.h3,{id:"72-working-with-async-functions",children:"7.2 Working with Async Functions"}),"\n",(0,s.jsx)(n.h2,{id:"8-thread-safety-and-memory-management",children:"8. Thread Safety and Memory Management"}),"\n",(0,s.jsx)(n.h3,{id:"81-pointer-management",children:"8.1 Pointer Management"}),"\n",(0,s.jsx)(n.p,{children:"The Go Port maintains a registry of Go pointers to allow callbacks from C code to access Go objects safely. This is implemented through a map protected by a mutex."}),"\n",(0,s.jsx)(n.h3,{id:"82-memory-safety",children:"8.2 Memory Safety"}),"\n",(0,s.jsx)(n.p,{children:"The Go Port ensures memory safety by:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Properly deallocating C memory in defer statements"}),"\n",(0,s.jsx)(n.li,{children:"Keeping track of Go objects referenced by C code"}),"\n",(0,s.jsx)(n.li,{children:"Using goroutines and channels to coordinate between Go and C"}),"\n",(0,s.jsx)(n.li,{children:"Maintaining a strict synchronization model"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"9-performance-considerations",children:"9. Performance Considerations"}),"\n",(0,s.jsx)(n.p,{children:"The Go Port includes benchmark tests that measure the performance of various operations. When working with the Go Port, consider:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"The overhead of crossing the CGO boundary"}),"\n",(0,s.jsx)(n.li,{children:"The cost of type conversions for complex types"}),"\n",(0,s.jsx)(n.li,{children:"The synchronization overhead of the thread-safe design"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"For performance-critical applications, batch operations where possible to minimize the number of cross-language calls."}),"\n",(0,s.jsxs)(n.p,{children:["Sources: ",(0,s.jsx)(n.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/ports/go_port/source/go_port_test.go#L202-L239",children:"source/ports/go_port/source/go_port_test.go202-239"})]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>l,x:()=>o});var i=r(6540);const s={},t=i.createContext(s);function l(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);