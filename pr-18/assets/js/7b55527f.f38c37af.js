"use strict";(globalThis.webpackChunkmetacall_doc=globalThis.webpackChunkmetacall_doc||[]).push([[6616],{8453:(e,t,s)=>{s.d(t,{R:()=>o,x:()=>a});var n=s(6540);const i={},r=n.createContext(i);function o(e){const t=n.useContext(r);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),n.createElement(r.Provider,{value:t},e.children)}},9107:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"metacall-core/writing-tests","title":"Writing Tests","description":"This document provides a comprehensive guide for writing and running tests for the MetaCall project. It covers the testing infrastructure, how to create new tests, and best practices for testing different language loaders and cross-language functionality.","source":"@site/docs/metacall-core/writing-tests.md","sourceDirName":"metacall-core","slug":"/metacall-core/writing-tests","permalink":"/doc/pr-18/docs/metacall-core/writing-tests","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Writing Tests"},"sidebar":"tutorialSidebar","previous":{"title":"Value Types","permalink":"/doc/pr-18/docs/metacall-core/value-types"},"next":{"title":"Understanding MetaCall CLI","permalink":"/doc/pr-18/docs/understanding-metacall-cli"}}');var i=s(4848),r=s(8453);const o={title:"Writing Tests"},a="Writing Tests",l={},c=[{value:"Testing Infrastructure",id:"testing-infrastructure",level:2},{value:"GTest Configuration",id:"gtest-configuration",level:3},{value:"Memory Check and Sanitizer Options",id:"memory-check-and-sanitizer-options",level:3},{value:"Creating a New Test",id:"creating-a-new-test",level:2},{value:"1. Create Directory Structure",id:"1-create-directory-structure",level:3},{value:"2. Configure CMakeLists.txt",id:"2-configure-cmakeliststxt",level:3},{value:"3. Implement the Test",id:"3-implement-the-test",level:3},{value:"4. Add to Main CMakeLists.txt",id:"4-add-to-main-cmakeliststxt",level:3},{value:"Writing Tests for Language Loaders",id:"writing-tests-for-language-loaders",level:2},{value:"Python Loader Tests",id:"python-loader-tests",level:3},{value:"Node.js Loader Tests",id:"nodejs-loader-tests",level:3},{value:"Cross-Language Integration Tests",id:"cross-language-integration-tests",level:3},{value:"Test Best Practices",id:"test-best-practices",level:2},{value:"Testing with Different Sanitizers",id:"testing-with-different-sanitizers",level:2},{value:"Address Sanitizer",id:"address-sanitizer",level:3},{value:"Thread Sanitizer",id:"thread-sanitizer",level:3},{value:"Memory Sanitizer",id:"memory-sanitizer",level:3},{value:"CI/CD Integration",id:"cicd-integration",level:2},{value:"Platform-Specific Test Workflows",id:"platform-specific-test-workflows",level:3},{value:"Troubleshooting Test Failures",id:"troubleshooting-test-failures",level:2}];function d(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"writing-tests",children:"Writing Tests"})}),"\n",(0,i.jsxs)(t.p,{children:["This document provides a comprehensive guide for writing and running tests for the MetaCall project. It covers the testing infrastructure, how to create new tests, and best practices for testing different language loaders and cross-language functionality.\nFor information about running existing tests, see ",(0,i.jsx)(t.a,{href:"/doc/pr-18/docs/metacall-core/running-tests",children:"Running Tests"}),". For details on using sanitizers to catch memory and threading issues, see ",(0,i.jsx)(t.a,{href:"/doc/pr-18/docs/metacall-core/sanitizers",children:"Sanitizers"}),"."]}),"\n",(0,i.jsx)(t.h2,{id:"testing-infrastructure",children:"Testing Infrastructure"}),"\n",(0,i.jsxs)(t.p,{children:["MetaCall uses Google Test (GTest) as its testing framework. Tests are organized by component and functionality, with each test residing in its own subdirectory under ",(0,i.jsx)(t.code,{children:"source/tests/"}),"."]}),"\n",(0,i.jsx)(t.h3,{id:"gtest-configuration",children:"GTest Configuration"}),"\n",(0,i.jsx)(t.p,{children:"MetaCall configures Google Test in the main test CMakeLists.txt file. If GTest is not found on the system, it is automatically downloaded and built:"}),"\n",(0,i.jsx)(t.h3,{id:"memory-check-and-sanitizer-options",children:"Memory Check and Sanitizer Options"}),"\n",(0,i.jsx)(t.p,{children:"MetaCall supports running tests with memory checkers and sanitizers to detect various issues:"}),"\n",(0,i.jsx)(t.h2,{id:"creating-a-new-test",children:"Creating a New Test"}),"\n",(0,i.jsx)(t.p,{children:"To create a new test for MetaCall, follow these steps:"}),"\n",(0,i.jsx)(t.h3,{id:"1-create-directory-structure",children:"1. Create Directory Structure"}),"\n",(0,i.jsxs)(t.p,{children:["Create a new directory under ",(0,i.jsx)(t.code,{children:"source/tests/"})," with the following structure:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"source/tests/my_new_test/\n\u251c\u2500\u2500 CMakeLists.txt        # Test build configuration\n\u2514\u2500\u2500 source/               # Test source files\n    \u2514\u2500\u2500 my_new_test.cpp   # Test implementation\n"})}),"\n",(0,i.jsx)(t.h3,{id:"2-configure-cmakeliststxt",children:"2. Configure CMakeLists.txt"}),"\n",(0,i.jsx)(t.p,{children:"Create a CMakeLists.txt file for your test:"}),"\n",(0,i.jsx)(t.h3,{id:"3-implement-the-test",children:"3. Implement the Test"}),"\n",(0,i.jsx)(t.p,{children:"Create a C++ file implementing your test using Google Test:"}),"\n",(0,i.jsx)(t.h3,{id:"4-add-to-main-cmakeliststxt",children:"4. Add to Main CMakeLists.txt"}),"\n",(0,i.jsxs)(t.p,{children:["Add your test to the main test configuration in ",(0,i.jsx)(t.code,{children:"source/tests/CMakeLists.txt"}),":"]}),"\n",(0,i.jsx)(t.h2,{id:"writing-tests-for-language-loaders",children:"Writing Tests for Language Loaders"}),"\n",(0,i.jsx)(t.p,{children:"MetaCall supports multiple language loaders, each requiring specific testing approaches."}),"\n",(0,i.jsx)(t.h3,{id:"python-loader-tests",children:"Python Loader Tests"}),"\n",(0,i.jsx)(t.p,{children:"Testing the Python loader involves loading Python code and calling Python functions:"}),"\n",(0,i.jsx)(t.h3,{id:"nodejs-loader-tests",children:"Node.js Loader Tests"}),"\n",(0,i.jsx)(t.p,{children:"Node.js tests often need to handle asynchronous code and promises:"}),"\n",(0,i.jsx)(t.h3,{id:"cross-language-integration-tests",children:"Cross-Language Integration Tests"}),"\n",(0,i.jsx)(t.p,{children:"MetaCall's primary feature is cross-language communication. Here's how to test it:"}),"\n",(0,i.jsx)(t.h2,{id:"test-best-practices",children:"Test Best Practices"}),"\n",(0,i.jsx)(t.p,{children:"When writing tests for MetaCall, follow these best practices:"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Resource Management"}),": Always initialize MetaCall at the beginning of tests and destroy it at the end to prevent memory leaks."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Memory Cleanup"}),": Explicitly destroy all MetaCall values created during tests."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Cross-Platform Compatibility"}),": Ensure tests work on all supported platforms (Windows, macOS, Linux)."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Test Isolation"}),": Each test should be independent and not depend on state from previous tests."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Error Handling"}),": Test both successful cases and error conditions."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Asynchronous Testing"}),": When testing asynchronous functions, use proper callback mechanisms to ensure test completion."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"CI Integration"}),": Be aware that tests run on CI with different sanitizers. Avoid assumptions about timing or system-specific behavior."]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"testing-with-different-sanitizers",children:"Testing with Different Sanitizers"}),"\n",(0,i.jsx)(t.p,{children:"MetaCall supports running tests with different sanitizers to catch memory and threading issues."}),"\n",(0,i.jsx)(t.h3,{id:"address-sanitizer",children:"Address Sanitizer"}),"\n",(0,i.jsx)(t.p,{children:"Address Sanitizer detects memory errors like use-after-free, buffer overflows, and memory leaks:"}),"\n",(0,i.jsx)(t.h3,{id:"thread-sanitizer",children:"Thread Sanitizer"}),"\n",(0,i.jsx)(t.p,{children:"Thread Sanitizer detects data races and threading issues:"}),"\n",(0,i.jsx)(t.h3,{id:"memory-sanitizer",children:"Memory Sanitizer"}),"\n",(0,i.jsx)(t.p,{children:"Memory Sanitizer detects uses of uninitialized memory (Clang only):"}),"\n",(0,i.jsx)(t.h2,{id:"cicd-integration",children:"CI/CD Integration"}),"\n",(0,i.jsx)(t.p,{children:"MetaCall automatically runs tests on multiple platforms through GitHub Actions workflows:"}),"\n",(0,i.jsx)(t.h3,{id:"platform-specific-test-workflows",children:"Platform-Specific Test Workflows"}),"\n",(0,i.jsx)(t.p,{children:"Each platform has its own workflow configuration:"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Linux Workflow"}),": Runs tests in different Docker containers with various sanitizers"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"macOS Workflow"}),": Runs tests on multiple macOS versions"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Windows Workflow"}),": Runs tests with MSVC compiler"]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"troubleshooting-test-failures",children:"Troubleshooting Test Failures"}),"\n",(0,i.jsx)(t.p,{children:"When a test fails, consider these troubleshooting steps:"}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Run With Verbose Output"}),": Use ",(0,i.jsx)(t.code,{children:"ctest --output-on-failure"})," to see detailed error messages."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Run Single Test"}),": Run just the failing test with ",(0,i.jsx)(t.code,{children:"ctest -R test_name"}),"."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Run With Sanitizers"}),": Use appropriate sanitizers to identify memory or threading issues."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Check Log Output"}),": Examine test logs for error messages or warnings."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Debug Build"}),": Rebuild in debug mode (",(0,i.jsx)(t.code,{children:"cmake -DCMAKE_BUILD_TYPE=Debug .."}),") for better error information."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.strong,{children:"Platform Differences"}),": Test failures may be platform-specific - check if the test fails on all platforms or just one."]}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["Sources: ",(0,i.jsx)(t.a,{href:"https://github.com/metacall/core/blob/af9cad19/tools/metacall-build.sh#L76-L78",children:"tools/metacall-build.sh76-78"})," ",(0,i.jsx)(t.a,{href:"https://github.com/metacall/core/blob/af9cad19/tools/metacall-build.ps1#L75-L85",children:"tools/metacall-build.ps175-85"})]})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);