"use strict";(globalThis.webpackChunkmetacall_doc=globalThis.webpackChunkmetacall_doc||[]).push([[5495],{1402:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"metacall-core/node-js-port","title":"Node.js Port","description":"This document describes the Node.js Port for MetaCall, a component that enables Node.js applications to call functions from other programming languages through MetaCall\'s foreign function interface. The Node.js Port provides a familiar JavaScript API for Node.js developers to seamlessly integrate with code written in Python, Ruby, C#, and other languages supported by MetaCall.","source":"@site/docs/metacall-core/node-js-port.md","sourceDirName":"metacall-core","slug":"/metacall-core/node-js-port","permalink":"/doc/pr-18/docs/metacall-core/node-js-port","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Node.js Port"},"sidebar":"tutorialSidebar","previous":{"title":"Node.js Loader","permalink":"/doc/pr-18/docs/metacall-core/node-js-loader"},"next":{"title":"Overview","permalink":"/doc/pr-18/docs/metacall-core/overview-core"}}');var t=i(4848),l=i(8453);const r={title:"Node.js Port"},a="Node.js Port",d={},o=[{value:"Architecture Overview",id:"architecture-overview",level:2},{value:"Installation and Setup",id:"installation-and-setup",level:2},{value:"Library Detection Process",id:"library-detection-process",level:3},{value:"Initialization Process",id:"initialization-process",level:2},{value:"API Reference",id:"api-reference",level:2},{value:"Function Details",id:"function-details",level:3},{value:"metacall",id:"metacall",level:4},{value:"metacall_load_from_file",id:"metacall_load_from_file",level:4},{value:"Require Override",id:"require-override",level:2},{value:"Language Tags and Extensions",id:"language-tags-and-extensions",level:3},{value:"Usage Examples",id:"usage-examples",level:2},{value:"Basic Usage",id:"basic-usage",level:3},{value:"Using Require Override",id:"using-require-override",level:3},{value:"Loading Python Modules",id:"loading-python-modules",level:3},{value:"Internal Implementation",id:"internal-implementation",level:2},{value:"Native Binding",id:"native-binding",level:3},{value:"Environment Variables",id:"environment-variables",level:2},{value:"Callbacks and Function Passing",id:"callbacks-and-function-passing",level:2},{value:"Distribution and Packaging",id:"distribution-and-packaging",level:2},{value:"Build and Test",id:"build-and-test",level:2},{value:"Limitations and Known Issues",id:"limitations-and-known-issues",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"nodejs-port",children:"Node.js Port"})}),"\n",(0,t.jsxs)(n.p,{children:["This document describes the Node.js Port for MetaCall, a component that enables Node.js applications to call functions from other programming languages through MetaCall's foreign function interface. The Node.js Port provides a familiar JavaScript API for Node.js developers to seamlessly integrate with code written in Python, Ruby, C#, and other languages supported by MetaCall.\nFor information about how language ports work in general, see ",(0,t.jsx)(n.a,{href:"/doc/pr-18/docs/metacall-core/port-system",children:"Port System"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"architecture-overview",children:"Architecture Overview"}),"\n",(0,t.jsxs)(n.p,{children:["The Node.js Port serves as a bridge between Node.js applications and the MetaCall Core. It exposes MetaCall's functionality through a module that can be imported using Node.js's standard ",(0,t.jsx)(n.code,{children:"require"})," function."]}),"\n",(0,t.jsx)(n.h2,{id:"installation-and-setup",children:"Installation and Setup"}),"\n",(0,t.jsxs)(n.p,{children:["The Node.js Port is available as an npm package named ",(0,t.jsx)(n.code,{children:"metacall"}),". It can be installed as follows:"]}),"\n",(0,t.jsxs)(n.p,{children:["However, this requires the MetaCall Core library to be installed on your system. The port will search for the library in standard locations or use the path specified by the ",(0,t.jsx)(n.code,{children:"METACALL_INSTALL_PATH"})," environment variable."]}),"\n",(0,t.jsx)(n.h3,{id:"library-detection-process",children:"Library Detection Process"}),"\n",(0,t.jsx)(n.p,{children:"The Node.js Port uses a sophisticated mechanism to locate the MetaCall Core library:"}),"\n",(0,t.jsx)(n.h2,{id:"initialization-process",children:"Initialization Process"}),"\n",(0,t.jsx)(n.p,{children:"The Node.js Port has two initialization modes:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Node Loader Mode"}),": When imported from within MetaCall runtime (via node_loader)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Standalone Mode"}),": When imported directly from Node.js"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"api-reference",children:"API Reference"}),"\n",(0,t.jsx)(n.p,{children:"The Node.js Port exposes the following core functions from MetaCall:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Function"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"metacall(name, ...args)"})}),(0,t.jsx)(n.td,{children:"Call a function by name with arguments"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"metacallfms(name, buffer)"})}),(0,t.jsx)(n.td,{children:"Call a function by name with a JSON string representing arguments"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"metacall_await(name, ...args)"})}),(0,t.jsx)(n.td,{children:"Call a function by name and await its result (for async functions)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"metacall_load_from_file(tag, paths)"})}),(0,t.jsx)(n.td,{children:"Load code from specified files with a language tag"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"metacall_load_from_memory(tag, code)"})}),(0,t.jsx)(n.td,{children:"Load code from a string with a language tag"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"metacall_load_from_package(tag, pkg)"})}),(0,t.jsx)(n.td,{children:"Load code from a package with a language tag"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"metacall_load_from_configuration(path)"})}),(0,t.jsx)(n.td,{children:"Load code from a MetaCall configuration file"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"metacall_inspect()"})}),(0,t.jsx)(n.td,{children:"Get reflection data about all loaded functions"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"function-details",children:"Function Details"}),"\n",(0,t.jsx)(n.h4,{id:"metacall",children:"metacall"}),"\n",(0,t.jsx)(n.p,{children:"Calls a function by name with the provided arguments. The function must have been previously loaded into the MetaCall runtime."}),"\n",(0,t.jsx)(n.h4,{id:"metacall_load_from_file",children:"metacall_load_from_file"}),"\n",(0,t.jsxs)(n.p,{children:["Loads code from files. The ",(0,t.jsx)(n.code,{children:"tag"})," parameter indicates the language (e.g., 'py' for Python, 'rb' for Ruby)."]}),"\n",(0,t.jsx)(n.h2,{id:"require-override",children:"Require Override"}),"\n",(0,t.jsxs)(n.p,{children:["One of the most powerful features of the Node.js Port is its extension of Node.js's ",(0,t.jsx)(n.code,{children:"require"})," function. This allows developers to directly import modules written in other languages using familiar syntax."]}),"\n",(0,t.jsx)(n.h3,{id:"language-tags-and-extensions",children:"Language Tags and Extensions"}),"\n",(0,t.jsx)(n.p,{children:"The Node.js Port supports the following language tags and file extensions:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Language"}),(0,t.jsx)(n.th,{children:"Tag"}),(0,t.jsx)(n.th,{children:"File Extensions"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Python"}),(0,t.jsx)(n.td,{children:"'py'"}),(0,t.jsx)(n.td,{children:".py"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Ruby"}),(0,t.jsx)(n.td,{children:"'rb'"}),(0,t.jsx)(n.td,{children:".rb"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"C#"}),(0,t.jsx)(n.td,{children:"'cs'"}),(0,t.jsx)(n.td,{children:".cs, .vb, .dll"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"TypeScript"}),(0,t.jsx)(n.td,{children:"'ts'"}),(0,t.jsx)(n.td,{children:".ts, .jsx, .tsx"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Rust"}),(0,t.jsx)(n.td,{children:"'rs'"}),(0,t.jsx)(n.td,{children:".rs, .rlib"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Mock (for testing)"}),(0,t.jsx)(n.td,{children:"'mock'"}),(0,t.jsx)(n.td,{children:".mock"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"C"}),(0,t.jsx)(n.td,{children:"'c'"}),(0,t.jsx)(n.td,{children:".c"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Cobol"}),(0,t.jsx)(n.td,{children:"'cob'"}),(0,t.jsx)(n.td,{children:".cob, .cbl, .cpy"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"WebAssembly"}),(0,t.jsx)(n.td,{children:"'wasm'"}),(0,t.jsx)(n.td,{children:".wat, .wasm"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"usage-examples",children:"Usage Examples"}),"\n",(0,t.jsx)(n.h3,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,t.jsx)(n.h3,{id:"using-require-override",children:"Using Require Override"}),"\n",(0,t.jsx)(n.h3,{id:"loading-python-modules",children:"Loading Python Modules"}),"\n",(0,t.jsx)(n.h2,{id:"internal-implementation",children:"Internal Implementation"}),"\n",(0,t.jsx)(n.p,{children:"The Node.js Port consists of several key components:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Library Detection"}),": Functions to locate the MetaCall library on different platforms"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Initialization Logic"}),": Code to initialize the port correctly in different contexts"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"API Bindings"}),": JavaScript functions that wrap the native C API"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Require Override"}),": Extension of the Node.js require system"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"native-binding",children:"Native Binding"}),"\n",(0,t.jsxs)(n.p,{children:["The Node.js Port communicates with the MetaCall Core through a native addon (",(0,t.jsx)(n.code,{children:"node_loader_port_module"}),"). In standalone mode, it dynamically loads the MetaCall library using Node.js's ",(0,t.jsx)(n.code,{children:"process.dlopen"})," function."]}),"\n",(0,t.jsx)(n.h2,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,t.jsx)(n.p,{children:"The Node.js Port recognizes the following environment variables:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Variable"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"METACALL_INSTALL_PATH"})}),(0,t.jsx)(n.td,{children:"Custom path to the MetaCall library"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"NODE_ENV"})}),(0,t.jsx)(n.td,{children:"When set to 'debug', enables debug logs"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"callbacks-and-function-passing",children:"Callbacks and Function Passing"}),"\n",(0,t.jsx)(n.p,{children:"The Node.js Port supports passing JavaScript functions as callbacks to functions in other languages, and vice versa. This allows for powerful integration scenarios:"}),"\n",(0,t.jsx)(n.h2,{id:"distribution-and-packaging",children:"Distribution and Packaging"}),"\n",(0,t.jsxs)(n.p,{children:["The Node.js Port is distributed as an npm package. The package structure is defined in ",(0,t.jsx)(n.code,{children:"package.json"})," and includes:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Main entry point: ",(0,t.jsx)(n.code,{children:"index.js"})]}),"\n",(0,t.jsxs)(n.li,{children:["TypeScript type definitions: ",(0,t.jsx)(n.code,{children:"index.d.ts"})]}),"\n",(0,t.jsx)(n.li,{children:"License: Apache-2.0"}),"\n",(0,t.jsx)(n.li,{children:"Keywords for npm search"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"build-and-test",children:"Build and Test"}),"\n",(0,t.jsx)(n.p,{children:"The Node.js Port is built as part of the MetaCall project using CMake. Tests verify functionality including:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Loading code from different languages"}),"\n",(0,t.jsx)(n.li,{children:"Calling functions across language boundaries"}),"\n",(0,t.jsx)(n.li,{children:"Passing callbacks between languages"}),"\n",(0,t.jsx)(n.li,{children:"Handle the overridden require function"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"limitations-and-known-issues",children:"Limitations and Known Issues"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Type conversion between languages has some limitations, particularly with complex types"}),"\n",(0,t.jsx)(n.li,{children:"Some language-specific features may not be fully supported across boundaries"}),"\n",(0,t.jsx)(n.li,{children:"Class instantiation and object method calls have limited support"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Sources: ",(0,t.jsx)(n.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/ports/node_port/test/index.js#L324-L329",children:"source/ports/node_port/test/index.js324-329"})]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>a});var s=i(6540);const t={},l=s.createContext(t);function r(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);