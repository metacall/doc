"use strict";(globalThis.webpackChunkmetacall_doc=globalThis.webpackChunkmetacall_doc||[]).push([[1250],{5490:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>d,contentTitle:()=>s,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"metacall-core/java-loader","title":"Java Loader","description":"The Java Loader is a component of the MetaCall Core that enables execution of Java code and interoperability between Java and other programming languages supported by MetaCall. This page documents the architecture, implementation, and functionality of the Java Loader.","source":"@site/docs/metacall-core/java-loader.md","sourceDirName":"metacall-core","slug":"/metacall-core/java-loader","permalink":"/doc/pr-17/docs/metacall-core/java-loader","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Java Loader"},"sidebar":"tutorialSidebar","previous":{"title":"Initialization and Shutdown","permalink":"/doc/pr-17/docs/metacall-core/initialization-and-shutdown"},"next":{"title":"Loader System","permalink":"/doc/pr-17/docs/metacall-core/loader-system"}}');var t=a(4848),r=a(8453);const l={title:"Java Loader"},s="Java Loader",d={},o=[{value:"Overview",id:"overview",level:2},{value:"Architecture",id:"architecture",level:2},{value:"Core Components",id:"core-components",level:2},{value:"Java Native Interface (JNI)",id:"java-native-interface-jni",level:3},{value:"Bootstrap Class",id:"bootstrap-class",level:3},{value:"Type Conversion System",id:"type-conversion-system",level:3},{value:"Loader Lifecycle",id:"loader-lifecycle",level:2},{value:"Initialization",id:"initialization",level:3},{value:"Loading Java Code",id:"loading-java-code",level:3},{value:"Class and Method Discovery",id:"class-and-method-discovery",level:2},{value:"Function Calling",id:"function-calling",level:2},{value:"Object Creation and Handling",id:"object-creation-and-handling",level:2},{value:"Array Handling",id:"array-handling",level:2},{value:"Type Signature Management",id:"type-signature-management",level:2},{value:"Example Usage",id:"example-usage",level:2},{value:"Limitations and Considerations",id:"limitations-and-considerations",level:2},{value:"Integration with MetaCall Core",id:"integration-with-metacall-core",level:2},{value:"References",id:"references",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"java-loader",children:"Java Loader"})}),"\n",(0,t.jsx)(n.p,{children:"The Java Loader is a component of the MetaCall Core that enables execution of Java code and interoperability between Java and other programming languages supported by MetaCall. This page documents the architecture, implementation, and functionality of the Java Loader."}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(n.p,{children:"The Java Loader provides the capability to load and execute Java code from files, memory, or Java Archive (JAR) packages. It bridges the gap between Java's runtime environment and MetaCall's foreign function interface (FFI) system by translating types, managing method calls, handling objects, and facilitating data exchange."}),"\n",(0,t.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,t.jsx)(n.p,{children:"The Java Loader architecture consists of three main components:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Java Loader Implementation"}),": A C++ module that implements the loader interface required by MetaCall and manages interaction with the JVM."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"JNI Interface"}),": The native interface that allows C++ code to interact with the Java Virtual Machine."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Bootstrap Java Class"}),": A utility class that helps with class loading, compilation, and reflection."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"core-components",children:"Core Components"}),"\n",(0,t.jsx)(n.h3,{id:"java-native-interface-jni",children:"Java Native Interface (JNI)"}),"\n",(0,t.jsx)(n.p,{children:"The Java Loader uses JNI to bridge between the C++ code in MetaCall and the Java Virtual Machine. It creates and maintains a JVM instance, handles Java method calls, field access, and object creation."}),"\n",(0,t.jsx)(n.h3,{id:"bootstrap-class",children:"Bootstrap Class"}),"\n",(0,t.jsx)(n.p,{children:"The bootstrap class is a Java utility class that provides functionality for:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Class loading and discovery"}),"\n",(0,t.jsx)(n.li,{children:"Java file compilation"}),"\n",(0,t.jsx)(n.li,{children:"Classpath management"}),"\n",(0,t.jsx)(n.li,{children:"Reflection utilities for method and field inspection"}),"\n",(0,t.jsx)(n.li,{children:"Type signature generation"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"type-conversion-system",children:"Type Conversion System"}),"\n",(0,t.jsx)(n.p,{children:"One of the key responsibilities of the Java Loader is converting between Java types and MetaCall value types. The loader implements bidirectional conversion for:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Java Type"}),(0,t.jsx)(n.th,{children:"MetaCall Type"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"boolean"}),(0,t.jsx)(n.td,{children:"BOOL"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"char"}),(0,t.jsx)(n.td,{children:"CHAR"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"short"}),(0,t.jsx)(n.td,{children:"SHORT"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"int"}),(0,t.jsx)(n.td,{children:"INT"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"long"}),(0,t.jsx)(n.td,{children:"LONG"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"float"}),(0,t.jsx)(n.td,{children:"FLOAT"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"double"}),(0,t.jsx)(n.td,{children:"DOUBLE"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"String"}),(0,t.jsx)(n.td,{children:"STRING"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"array"}),(0,t.jsx)(n.td,{children:"ARRAY"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Object"}),(0,t.jsx)(n.td,{children:"OBJECT"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Class"}),(0,t.jsx)(n.td,{children:"CLASS"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"loader-lifecycle",children:"Loader Lifecycle"}),"\n",(0,t.jsx)(n.h3,{id:"initialization",children:"Initialization"}),"\n",(0,t.jsx)(n.p,{children:"The Java Loader initializes by creating a Java Virtual Machine instance and setting up the JNI environment. It also loads the bootstrap class which helps with class and method resolution."}),"\n",(0,t.jsx)(n.h3,{id:"loading-java-code",children:"Loading Java Code"}),"\n",(0,t.jsx)(n.p,{children:"The Java Loader can load Java code from:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Files"}),": Java source files (.java) that get compiled at runtime"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Memory"}),": Java code supplied as a string, compiled at runtime"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Packages"}),": Pre-compiled JAR files or .class files"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"class-and-method-discovery",children:"Class and Method Discovery"}),"\n",(0,t.jsx)(n.p,{children:"After loading Java code, the loader discovers classes, methods, and fields using Java reflection. This information is registered with MetaCall's reflection system to make Java functions callable from other languages."}),"\n",(0,t.jsx)(n.h2,{id:"function-calling",children:"Function Calling"}),"\n",(0,t.jsx)(n.p,{children:"When a Java method is called through MetaCall, the following process occurs:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Arguments are converted from MetaCall values to JNI values"}),"\n",(0,t.jsx)(n.li,{children:"The method is located using JNI function lookups"}),"\n",(0,t.jsx)(n.li,{children:"The method is invoked via JNI"}),"\n",(0,t.jsx)(n.li,{children:"The return value is converted back to a MetaCall value"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"object-creation-and-handling",children:"Object Creation and Handling"}),"\n",(0,t.jsx)(n.p,{children:"The Java Loader supports creating Java objects (class instances) and manipulating them:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Constructing objects with arguments"}),"\n",(0,t.jsx)(n.li,{children:"Getting and setting field values"}),"\n",(0,t.jsx)(n.li,{children:"Calling instance methods"}),"\n",(0,t.jsx)(n.li,{children:"Managing object lifecycle"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"array-handling",children:"Array Handling"}),"\n",(0,t.jsx)(n.p,{children:"The Java Loader has special handling for Java arrays, supporting both getting and setting array elements, as well as passing arrays as method arguments and returning arrays from methods."}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Java Array Type"}),(0,t.jsx)(n.th,{children:"Handling Method"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"boolean[]"}),(0,t.jsx)(n.td,{children:"jbooleanArray with GetBooleanArrayElements/SetBooleanArrayRegion"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"char[]"}),(0,t.jsx)(n.td,{children:"jcharArray with GetCharArrayElements/SetCharArrayRegion"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"short[]"}),(0,t.jsx)(n.td,{children:"jshortArray with GetShortArrayElements/SetShortArrayRegion"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"int[]"}),(0,t.jsx)(n.td,{children:"jintArray with GetIntArrayElements/SetIntArrayRegion"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"long[]"}),(0,t.jsx)(n.td,{children:"jlongArray with GetLongArrayElements/SetLongArrayRegion"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"float[]"}),(0,t.jsx)(n.td,{children:"jfloatArray with GetFloatArrayElements/SetFloatArrayRegion"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"double[]"}),(0,t.jsx)(n.td,{children:"jdoubleArray with GetDoubleArrayElements/SetDoubleArrayRegion"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"String[]"}),(0,t.jsx)(n.td,{children:"jobjectArray with GetObjectArrayElement/SetObjectArrayElement"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"type-signature-management",children:"Type Signature Management"}),"\n",(0,t.jsx)(n.p,{children:"The Java Loader needs to handle JNI type signatures for method calls and field access. It includes utilities for:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Creating JNI signatures for methods and constructors"}),"\n",(0,t.jsx)(n.li,{children:"Converting between Java type names and JNI type signatures"}),"\n",(0,t.jsx)(n.li,{children:"Handling array type signatures"}),"\n",(0,t.jsx)(n.li,{children:"Supporting primitive and object type signatures"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"example-usage",children:"Example Usage"}),"\n",(0,t.jsx)(n.p,{children:"The tests in the codebase demonstrate how to use the Java Loader:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Loading Java code"}),":"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Creating a Java object"}),":"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Getting and setting static fields"}),":"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Calling static methods"}),":"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Working with instance methods and fields"}),":"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"limitations-and-considerations",children:"Limitations and Considerations"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Exception Handling"}),": Java exceptions are currently not fully propagated back to MetaCall."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Asynchronous Methods"}),": Await functionality is not supported in the Java Loader (",(0,t.jsx)(n.code,{children:"java_object_interface_method_await"})," is empty)."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Advanced Java Features"}),": Some Java features like generics have limited support."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Performance"}),": Dynamic compilation and reflection have performance implications."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Memory Management"}),": Care must be taken to properly manage memory when working with Java objects."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"integration-with-metacall-core",children:"Integration with MetaCall Core"}),"\n",(0,t.jsx)(n.p,{children:"The Java Loader integrates with MetaCall Core through the loader interface, which includes functions for:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Initialization and destruction"}),"\n",(0,t.jsx)(n.li,{children:"Loading code from various sources"}),"\n",(0,t.jsx)(n.li,{children:"Discovering functions and types"}),"\n",(0,t.jsx)(n.li,{children:"Creating and manipulating objects"}),"\n",(0,t.jsx)(n.li,{children:"Type conversion"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["For more information about the general loader system, see ",(0,t.jsx)(n.a,{href:"/doc/pr-17/docs/metacall-core/loader-system",children:"Loader System"})]}),"\n",(0,t.jsxs)(n.li,{children:["For information about other language loaders, see:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/doc/pr-17/docs/metacall-core/python-loader",children:"Python Loader"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/doc/pr-17/docs/metacall-core/node-js-loader",children:"Node.js Loader"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/doc/pr-17/docs/metacall-core/ruby-loader",children:"Ruby Loader"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/doc/pr-17/docs/metacall-core/rust-loader",children:"Rust Loader"})}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453:(e,n,a)=>{a.d(n,{R:()=>l,x:()=>s});var i=a(6540);const t={},r=i.createContext(t);function l(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);