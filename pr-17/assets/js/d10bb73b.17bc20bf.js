"use strict";(globalThis.webpackChunkmetacall_doc=globalThis.webpackChunkmetacall_doc||[]).push([[9330],{5950:(e,n,d)=>{d.r(n),d.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"metacall-core/loaders","title":"Loaders","description":"Loaders are a fundamental component of the MetaCall system, responsible for loading and executing code from different programming languages. Each loader acts as a bridge between the MetaCall Core and a specific language runtime, enabling cross-language function calls. This document provides a detailed overview of the loader architecture, implementation, and the various language loaders supported by MetaCall.","source":"@site/docs/metacall-core/loaders.md","sourceDirName":"metacall-core","slug":"/metacall-core/loaders","permalink":"/doc/pr-17/docs/metacall-core/loaders","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Loaders"},"sidebar":"tutorialSidebar","previous":{"title":"Loader System","permalink":"/doc/pr-17/docs/metacall-core/loader-system"},"next":{"title":"Loading Code","permalink":"/doc/pr-17/docs/metacall-core/loading-code"}}');var l=d(4848),i=d(8453);const s={title:"Loaders"},a="Loaders",o={},c=[{value:"Architecture Overview",id:"architecture-overview",level:2},{value:"Loader Interface",id:"loader-interface",level:2},{value:"Interface Functions",id:"interface-functions",level:3},{value:"Loader Manager",id:"loader-manager",level:2},{value:"Supported Loaders",id:"supported-loaders",level:2},{value:"Node.js Loader",id:"nodejs-loader",level:3},{value:"Value Conversion",id:"value-conversion",level:4},{value:"Python Loader",id:"python-loader",level:3},{value:"Ruby Loader",id:"ruby-loader",level:3},{value:"C# Loader",id:"c-loader",level:3},{value:"TypeScript Loader",id:"typescript-loader",level:3},{value:"C Loader",id:"c-loader-1",level:3},{value:"Cross-Language Function Calls",id:"cross-language-function-calls",level:2},{value:"Asynchronous Function Calls",id:"asynchronous-function-calls",level:2},{value:"Building and Configuring Loaders",id:"building-and-configuring-loaders",level:2},{value:"Loader Configuration",id:"loader-configuration",level:2},{value:"Creating Custom Loaders",id:"creating-custom-loaders",level:2}];function t(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"loaders",children:"Loaders"})}),"\n",(0,l.jsxs)(n.p,{children:["Loaders are a fundamental component of the MetaCall system, responsible for loading and executing code from different programming languages. Each loader acts as a bridge between the MetaCall Core and a specific language runtime, enabling cross-language function calls. This document provides a detailed overview of the loader architecture, implementation, and the various language loaders supported by MetaCall.\nFor information about Ports (which enable using MetaCall from within a specific language), see ",(0,l.jsx)(n.a,{href:"/doc/pr-17/docs/metacall-core/ports",children:"Ports"}),"."]}),"\n",(0,l.jsx)(n.h2,{id:"architecture-overview",children:"Architecture Overview"}),"\n",(0,l.jsx)(n.h2,{id:"loader-interface",children:"Loader Interface"}),"\n",(0,l.jsxs)(n.p,{children:["All loaders implement a common interface defined in the loader implementation interface (",(0,l.jsx)(n.code,{children:"loader_impl_interface"}),"). This standardized interface enables MetaCall to interact with various language runtimes in a consistent manner."]}),"\n",(0,l.jsx)(n.h3,{id:"interface-functions",children:"Interface Functions"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Function"}),(0,l.jsx)(n.th,{children:"Purpose"}),(0,l.jsx)(n.th,{children:"Parameters"}),(0,l.jsx)(n.th,{children:"Return Value"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"initialize"})}),(0,l.jsx)(n.td,{children:"Initialize the loader with configuration"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"loader_impl impl, configuration config"})}),(0,l.jsx)(n.td,{children:"Pointer to loader data"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"execution_path"})}),(0,l.jsx)(n.td,{children:"Add a path to runtime's search paths"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"loader_impl impl, const loader_path path"})}),(0,l.jsx)(n.td,{children:"0 on success, non-zero on failure"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"load_from_file"})}),(0,l.jsx)(n.td,{children:"Load code from file(s)"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"loader_impl impl, const loader_path paths[], size_t size"})}),(0,l.jsx)(n.td,{children:"Handle to loaded code"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"load_from_memory"})}),(0,l.jsx)(n.td,{children:"Load code from memory buffer"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"loader_impl impl, const loader_name name, const char *buffer, size_t size"})}),(0,l.jsx)(n.td,{children:"Handle to loaded code"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"load_from_package"})}),(0,l.jsx)(n.td,{children:"Load code from a package"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"loader_impl impl, const loader_path path"})}),(0,l.jsx)(n.td,{children:"Handle to loaded code"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"clear"})}),(0,l.jsx)(n.td,{children:"Unload code"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"loader_impl impl, loader_handle handle"})}),(0,l.jsx)(n.td,{children:"0 on success, non-zero on failure"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"discover"})}),(0,l.jsx)(n.td,{children:"Discover and register functions"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"loader_impl impl, loader_handle handle, context ctx"})}),(0,l.jsx)(n.td,{children:"0 on success, non-zero on failure"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"destroy"})}),(0,l.jsx)(n.td,{children:"Clean up loader resources"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"loader_impl impl"})}),(0,l.jsx)(n.td,{children:"0 on success, non-zero on failure"})]})]})]}),"\n",(0,l.jsx)(n.h2,{id:"loader-manager",children:"Loader Manager"}),"\n",(0,l.jsx)(n.p,{children:"The Loader Manager acts as a central coordinator for all loader operations. It:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Loads loader plugins dynamically at runtime based on configuration"}),"\n",(0,l.jsx)(n.li,{children:"Registers loaders with the MetaCall core"}),"\n",(0,l.jsx)(n.li,{children:"Dispatches function calls to the appropriate loader"}),"\n",(0,l.jsx)(n.li,{children:"Manages loader lifecycle"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"supported-loaders",children:"Supported Loaders"}),"\n",(0,l.jsx)(n.p,{children:"MetaCall includes several language loaders, each implemented as a plugin that can be enabled or disabled during build configuration."}),"\n",(0,l.jsx)(n.h3,{id:"nodejs-loader",children:"Node.js Loader"}),"\n",(0,l.jsxs)(n.p,{children:["The Node.js loader (",(0,l.jsx)(n.code,{children:"node_loader"}),") enables loading and executing JavaScript code using Node.js."]}),"\n",(0,l.jsx)(n.p,{children:"The Node.js loader works by:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Starting a Node.js runtime in a separate thread"}),"\n",(0,l.jsxs)(n.li,{children:["Loading a bootstrap script (",(0,l.jsx)(n.code,{children:"bootstrap.js"}),") to set up the environment"]}),"\n",(0,l.jsx)(n.li,{children:"Using a trampoline mechanism to handle communication between C++ and JavaScript"}),"\n",(0,l.jsx)(n.li,{children:"Supporting asynchronous function calls with promises"}),"\n",(0,l.jsx)(n.li,{children:"Converting between MetaCall values and JavaScript values using N-API"}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"value-conversion",children:"Value Conversion"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"MetaCall Type"}),(0,l.jsx)(n.th,{children:"JavaScript Type"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"null"})}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.code,{children:"null"})," or ",(0,l.jsx)(n.code,{children:"undefined"})]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"bool"})}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"boolean"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.code,{children:"int"}),"/",(0,l.jsx)(n.code,{children:"long"}),"/",(0,l.jsx)(n.code,{children:"double"})]}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"number"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"string"})}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"string"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"array"})}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"Array"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"map"})}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"Object"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"function"})}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"Function"})})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"future"})}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"Promise"})})]})]})]}),"\n",(0,l.jsx)(n.h3,{id:"python-loader",children:"Python Loader"}),"\n",(0,l.jsxs)(n.p,{children:["The Python loader (",(0,l.jsx)(n.code,{children:"py_loader"}),") enables loading and executing Python code."]}),"\n",(0,l.jsx)(n.p,{children:"The Python loader:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Initializes the Python interpreter"}),"\n",(0,l.jsx)(n.li,{children:"Uses the Python C API to interact with Python"}),"\n",(0,l.jsx)(n.li,{children:"Provides special handling for Python dictionaries"}),"\n",(0,l.jsx)(n.li,{children:"Includes threading support for Python"}),"\n",(0,l.jsx)(n.li,{children:"Converts between MetaCall values and Python objects"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"ruby-loader",children:"Ruby Loader"}),"\n",(0,l.jsxs)(n.p,{children:["The Ruby loader (",(0,l.jsx)(n.code,{children:"rb_loader"}),") enables loading and executing Ruby code."]}),"\n",(0,l.jsx)(n.h3,{id:"c-loader",children:"C# Loader"}),"\n",(0,l.jsxs)(n.p,{children:["The C# loader (",(0,l.jsx)(n.code,{children:"cs_loader"}),") enables loading and executing C# code using .NET Core."]}),"\n",(0,l.jsx)(n.h3,{id:"typescript-loader",children:"TypeScript Loader"}),"\n",(0,l.jsxs)(n.p,{children:["The TypeScript loader (",(0,l.jsx)(n.code,{children:"ts_loader"}),") is built on top of the Node.js loader. It transpiles TypeScript code to JavaScript and then utilizes the Node.js loader for execution."]}),"\n",(0,l.jsx)(n.p,{children:"The TypeScript loader:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Depends on the Node.js loader"}),"\n",(0,l.jsx)(n.li,{children:"Uses TypeScript's compiler API to transpile TypeScript to JavaScript"}),"\n",(0,l.jsx)(n.li,{children:"Provides type information for function discovery"}),"\n",(0,l.jsx)(n.li,{children:"Handles TypeScript-specific language features"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"c-loader-1",children:"C Loader"}),"\n",(0,l.jsxs)(n.p,{children:["The C loader (",(0,l.jsx)(n.code,{children:"c_loader"}),") enables loading and executing C code at runtime using the Tiny C Compiler."]}),"\n",(0,l.jsx)(n.h2,{id:"cross-language-function-calls",children:"Cross-Language Function Calls"}),"\n",(0,l.jsx)(n.h2,{id:"asynchronous-function-calls",children:"Asynchronous Function Calls"}),"\n",(0,l.jsx)(n.p,{children:"MetaCall supports asynchronous function calls through its future system. This is particularly important for languages like JavaScript that have built-in asynchronous programming models."}),"\n",(0,l.jsx)(n.h2,{id:"building-and-configuring-loaders",children:"Building and Configuring Loaders"}),"\n",(0,l.jsx)(n.p,{children:"Loaders are built as plugins and can be enabled or disabled using CMake options. Each loader has its own set of dependencies that must be installed on the system."}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Loader"}),(0,l.jsx)(n.th,{children:"CMake Option"}),(0,l.jsx)(n.th,{children:"Dependencies"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Node.js"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"OPTION_BUILD_LOADERS_NODE"})}),(0,l.jsx)(n.td,{children:"Node.js development libraries"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Python"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"OPTION_BUILD_LOADERS_PY"})}),(0,l.jsx)(n.td,{children:"Python development libraries"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Ruby"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"OPTION_BUILD_LOADERS_RB"})}),(0,l.jsx)(n.td,{children:"Ruby development libraries"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"C#"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"OPTION_BUILD_LOADERS_CS"})}),(0,l.jsx)(n.td,{children:".NET Core development libraries"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"TypeScript"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"OPTION_BUILD_LOADERS_TS"})}),(0,l.jsx)(n.td,{children:"Node.js loader"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"C"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"OPTION_BUILD_LOADERS_C"})}),(0,l.jsx)(n.td,{children:"TCC, libffi, libclang"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"JavaScript (V8)"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"OPTION_BUILD_LOADERS_JS"})}),(0,l.jsx)(n.td,{children:"V8 libraries"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"JavaScript (SpiderMonkey)"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"OPTION_BUILD_LOADERS_JSM"})}),(0,l.jsx)(n.td,{children:"SpiderMonkey libraries"})]})]})]}),"\n",(0,l.jsx)(n.h2,{id:"loader-configuration",children:"Loader Configuration"}),"\n",(0,l.jsx)(n.p,{children:"Loaders can be configured using the MetaCall configuration system. Configuration options are loader-specific and typically include paths to runtime executables, library paths, and runtime options."}),"\n",(0,l.jsx)(n.p,{children:"Example configuration for the Node.js loader:"}),"\n",(0,l.jsx)(n.h2,{id:"creating-custom-loaders",children:"Creating Custom Loaders"}),"\n",(0,l.jsx)(n.p,{children:"To create a custom loader for a new language, you need to:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Create a new loader module with the required interface functions"}),"\n",(0,l.jsx)(n.li,{children:"Implement value conversion between MetaCall values and language-specific values"}),"\n",(0,l.jsx)(n.li,{children:"Build the loader as a plugin"}),"\n",(0,l.jsx)(n.li,{children:"Register the loader with the loader manager"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Here's a simplified outline of a custom loader implementation:"}),"\n",(0,l.jsx)(n.p,{children:"A full implementation would also need to handle value conversion, function discovery, error handling, and proper cleanup of resources."})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(t,{...e})}):t(e)}},8453:(e,n,d)=>{d.d(n,{R:()=>s,x:()=>a});var r=d(6540);const l={},i=r.createContext(l);function s(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:s(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);