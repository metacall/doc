"use strict";(globalThis.webpackChunkmetacall_doc=globalThis.webpackChunkmetacall_doc||[]).push([[6419],{1492:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"metacall-core/running-tests","title":"Running Tests","description":"This page provides comprehensive guidance on executing tests within the MetaCall Core project. It covers running tests locally across different platforms, using sanitizers, and navigating test output. For information about writing new tests, see Writing Tests.","source":"@site/docs/metacall-core/running-tests.md","sourceDirName":"metacall-core","slug":"/metacall-core/running-tests","permalink":"/doc/docs/metacall-core/running-tests","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Running Tests"},"sidebar":"tutorialSidebar","previous":{"title":"Ruby Port","permalink":"/doc/docs/metacall-core/ruby-port"},"next":{"title":"Rust Loader","permalink":"/doc/docs/metacall-core/rust-loader"}}');var t=n(4848),r=n(8453);const l={title:"Running Tests"},d="Running Tests",c={},o=[{value:"Test Architecture",id:"test-architecture",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Dependencies",id:"dependencies",level:3},{value:"Building with Tests Enabled",id:"building-with-tests-enabled",level:2},{value:"Using Build Scripts",id:"using-build-scripts",level:3},{value:"Manual CMake Configuration",id:"manual-cmake-configuration",level:3},{value:"Running Tests",id:"running-tests-1",level:2},{value:"Running All Tests",id:"running-all-tests",level:3},{value:"Running Specific Tests",id:"running-specific-tests",level:3},{value:"Test Environment Variables",id:"test-environment-variables",level:3},{value:"Advanced Testing",id:"advanced-testing",level:2},{value:"Memory Checks with Valgrind",id:"memory-checks-with-valgrind",level:3},{value:"Sanitizers",id:"sanitizers",level:3},{value:"CI/CD Test Workflows",id:"cicd-test-workflows",level:3},{value:"Docker-Based Testing",id:"docker-based-testing",level:2},{value:"Interpreting Test Results",id:"interpreting-test-results",level:2},{value:"Common Test Failures",id:"common-test-failures",level:3},{value:"Platform-Specific Considerations",id:"platform-specific-considerations",level:3},{value:"Linux",id:"linux",level:4},{value:"macOS",id:"macos",level:4},{value:"Windows",id:"windows",level:4},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Testing Checklist",id:"testing-checklist",level:2}];function a(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"running-tests",children:"Running Tests"})}),"\n",(0,t.jsxs)(s.p,{children:["This page provides comprehensive guidance on executing tests within the MetaCall Core project. It covers running tests locally across different platforms, using sanitizers, and navigating test output. For information about writing new tests, see ",(0,t.jsx)(s.a,{href:"/doc/docs/metacall-core/writing-tests",children:"Writing Tests"}),"."]}),"\n",(0,t.jsx)(s.h2,{id:"test-architecture",children:"Test Architecture"}),"\n",(0,t.jsx)(s.p,{children:"MetaCall Core includes a comprehensive testing framework to ensure reliability of cross-language function calls. The testing system is built on Google Test (GTest) and is integrated with CMake's CTest infrastructure."}),"\n",(0,t.jsx)(s.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsx)(s.p,{children:"Before running tests, ensure you have:"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:"Built MetaCall with the tests enabled"}),"\n",(0,t.jsx)(s.li,{children:"Set up the required dependencies for the loaders you want to test"}),"\n",(0,t.jsx)(s.li,{children:"Configured the necessary environment variables"}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"dependencies",children:"Dependencies"}),"\n",(0,t.jsx)(s.p,{children:"The test suite requires Google Test (GTest) which is automatically installed when building tests if not found on your system."}),"\n",(0,t.jsx)(s.h2,{id:"building-with-tests-enabled",children:"Building with Tests Enabled"}),"\n",(0,t.jsxs)(s.p,{children:["Tests are enabled via the ",(0,t.jsx)(s.code,{children:"OPTION_BUILD_TESTS"})," CMake option, which is ON by default. You can disable tests by setting this option to OFF."]}),"\n",(0,t.jsx)(s.h3,{id:"using-build-scripts",children:"Using Build Scripts"}),"\n",(0,t.jsx)(s.p,{children:"The easiest way to build MetaCall with tests is using the provided build scripts:"}),"\n",(0,t.jsx)(s.p,{children:"On Linux/macOS:"}),"\n",(0,t.jsx)(s.p,{children:"On Windows:"}),"\n",(0,t.jsx)(s.h3,{id:"manual-cmake-configuration",children:"Manual CMake Configuration"}),"\n",(0,t.jsx)(s.p,{children:"Alternatively, you can manually configure CMake:"}),"\n",(0,t.jsx)(s.h2,{id:"running-tests-1",children:"Running Tests"}),"\n",(0,t.jsx)(s.h3,{id:"running-all-tests",children:"Running All Tests"}),"\n",(0,t.jsx)(s.p,{children:"After building, you can run all tests using CTest:"}),"\n",(0,t.jsx)(s.p,{children:"On Windows:"}),"\n",(0,t.jsx)(s.p,{children:"Alternatively, use the build script which automatically runs the tests:"}),"\n",(0,t.jsx)(s.h3,{id:"running-specific-tests",children:"Running Specific Tests"}),"\n",(0,t.jsxs)(s.p,{children:["To run specific tests, you can use the ",(0,t.jsx)(s.code,{children:"--tests-regex"})," option with CTest:"]}),"\n",(0,t.jsx)(s.p,{children:"Common test categories include:"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Test Category"}),(0,t.jsx)(s.th,{children:"Description"}),(0,t.jsx)(s.th,{children:"Example"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Core tests"}),(0,t.jsx)(s.td,{children:"Tests for core functionality"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"ctest -R metacall_test"})})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Loader tests"}),(0,t.jsx)(s.td,{children:"Tests for specific language loaders"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"ctest -R metacall_python_test"})})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Port tests"}),(0,t.jsx)(s.td,{children:"Tests for language ports"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"ctest -R metacall_node_port_test"})})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Integration tests"}),(0,t.jsx)(s.td,{children:"Tests for cross-language functionality"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"ctest -R metacall_integration_test"})})]})]})]}),"\n",(0,t.jsx)(s.h3,{id:"test-environment-variables",children:"Test Environment Variables"}),"\n",(0,t.jsx)(s.p,{children:"Tests require specific environment variables to locate loader plugins, scripts, configuration files, etc. These are automatically set by the build system, but if you're running tests manually, you'll need to set them:"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Environment Variable"}),(0,t.jsx)(s.th,{children:"Description"}),(0,t.jsx)(s.th,{children:"Default Value"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"LOADER_LIBRARY_PATH"})}),(0,t.jsx)(s.td,{children:"Directory where loader plugins are located"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"build"})})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"LOADER_SCRIPT_PATH"})}),(0,t.jsx)(s.td,{children:"Directory where scripts to be loaded are located"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"build/scripts"})})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"CONFIGURATION_PATH"})}),(0,t.jsx)(s.td,{children:"Global configuration file path"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"build/configurations/global.json"})})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"SERIAL_LIBRARY_PATH"})}),(0,t.jsx)(s.td,{children:"Directory where serial plugins are located"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"build"})})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"DETOUR_LIBRARY_PATH"})}),(0,t.jsx)(s.td,{children:"Directory where detour plugins are located"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"build"})})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"PORT_LIBRARY_PATH"})}),(0,t.jsx)(s.td,{children:"Directory where port plugins are located"}),(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"build"})})]})]})]}),"\n",(0,t.jsx)(s.h2,{id:"advanced-testing",children:"Advanced Testing"}),"\n",(0,t.jsx)(s.h3,{id:"memory-checks-with-valgrind",children:"Memory Checks with Valgrind"}),"\n",(0,t.jsx)(s.p,{children:"MetaCall supports running tests with memory checking using Valgrind. This helps detect memory leaks and other memory-related issues."}),"\n",(0,t.jsx)(s.p,{children:"To enable memory checks:"}),"\n",(0,t.jsx)(s.p,{children:"Note: Memory checks are not compatible with sanitizers."}),"\n",(0,t.jsx)(s.h3,{id:"sanitizers",children:"Sanitizers"}),"\n",(0,t.jsx)(s.p,{children:"MetaCall supports various sanitizers to detect runtime issues:"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Address Sanitizer (ASan)"})," - Detects memory errors like buffer overflows and use-after-free"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Thread Sanitizer (TSan)"})," - Detects data races and threading issues"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Memory Sanitizer (MSan)"})," - Detects uninitialized memory reads"]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"To build and run tests with sanitizers:"}),"\n",(0,t.jsx)(s.h3,{id:"cicd-test-workflows",children:"CI/CD Test Workflows"}),"\n",(0,t.jsxs)(s.p,{children:["MetaCall uses GitHub Actions to run tests on different platforms (Linux, macOS, Windows) and configurations. These workflows are defined in ",(0,t.jsx)(s.code,{children:".github/workflows/"}),"."]}),"\n",(0,t.jsx)(s.h2,{id:"docker-based-testing",children:"Docker-Based Testing"}),"\n",(0,t.jsx)(s.p,{children:"MetaCall provides Docker-based testing to ensure a consistent testing environment regardless of the host system."}),"\n",(0,t.jsx)(s.p,{children:"The Docker-based testing uses the following services:"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"deps"})," - Installs all dependencies"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"dev"})," - Builds the project and runs tests"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"runtime"})," - Creates a runtime image for deployment testing"]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"interpreting-test-results",children:"Interpreting Test Results"}),"\n",(0,t.jsx)(s.p,{children:"Test output includes pass/fail status for each test. If a test fails, detailed error information is displayed:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"[  RUN     ] TestSuite.TestName\n[    INFO ] Additional information...\n[  FAILED  ] TestSuite.TestName (X ms)\n"})}),"\n",(0,t.jsx)(s.p,{children:"For memory checks and sanitizers, additional error information is provided, such as memory leak details or race condition information."}),"\n",(0,t.jsx)(s.h3,{id:"common-test-failures",children:"Common Test Failures"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Error Type"}),(0,t.jsx)(s.th,{children:"Description"}),(0,t.jsx)(s.th,{children:"Possible Cause"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Segmentation fault"}),(0,t.jsx)(s.td,{children:"The program accessed an invalid memory address"}),(0,t.jsx)(s.td,{children:"Null pointer dereference, buffer overflow"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Memory leak"}),(0,t.jsx)(s.td,{children:"Memory was allocated but not freed"}),(0,t.jsx)(s.td,{children:"Forgot to clean up resources"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Timeout"}),(0,t.jsx)(s.td,{children:"The test took too long to complete"}),(0,t.jsx)(s.td,{children:"Infinite loop, deadlock"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Assertion failed"}),(0,t.jsx)(s.td,{children:"A test assertion did not pass"}),(0,t.jsx)(s.td,{children:"Incorrect behavior, regression"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Race condition"}),(0,t.jsx)(s.td,{children:"Concurrent access to shared data"}),(0,t.jsx)(s.td,{children:"Missing synchronization"})]})]})]}),"\n",(0,t.jsx)(s.h3,{id:"platform-specific-considerations",children:"Platform-Specific Considerations"}),"\n",(0,t.jsx)(s.h4,{id:"linux",children:"Linux"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Most comprehensive test coverage"}),"\n",(0,t.jsx)(s.li,{children:"Supports all sanitizers (ASan, TSan, MSan)"}),"\n",(0,t.jsx)(s.li,{children:"Supports memory check with Valgrind"}),"\n"]}),"\n",(0,t.jsx)(s.h4,{id:"macos",children:"macOS"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Some tests might be disabled due to platform limitations"}),"\n",(0,t.jsx)(s.li,{children:"Supports ASan and TSan sanitizers"}),"\n",(0,t.jsx)(s.li,{children:"Fork safety might be disabled for some tests"}),"\n"]}),"\n",(0,t.jsx)(s.h4,{id:"windows",children:"Windows"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"More limited sanitizer support (only ASan)"}),"\n",(0,t.jsx)(s.li,{children:"Different path handling might cause issues in some tests"}),"\n",(0,t.jsx)(s.li,{children:"Uses MSVC compiler which might have different behavior"}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,t.jsx)(s.p,{children:"If you encounter issues running tests, try the following:"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["Ensure all dependencies are properly installed with ",(0,t.jsx)(s.code,{children:"metacall-environment.sh"})]}),"\n",(0,t.jsx)(s.li,{children:"Check that environment variables are correctly set"}),"\n",(0,t.jsx)(s.li,{children:"Rebuild the project with clean build directory"}),"\n",(0,t.jsx)(s.li,{children:"For loader-specific tests, verify that the language runtime is properly installed"}),"\n",(0,t.jsx)(s.li,{children:"For platform-specific issues, check the CI/CD workflows for the correct configuration"}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"testing-checklist",children:"Testing Checklist"}),"\n",(0,t.jsx)(s.p,{children:"Before submitting changes:"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:"\u2705 Run unit tests locally"}),"\n",(0,t.jsx)(s.li,{children:"\u2705 Run tests with address sanitizer"}),"\n",(0,t.jsx)(s.li,{children:"\u2705 For threading-related changes, run thread sanitizer"}),"\n",(0,t.jsx)(s.li,{children:"\u2705 For platform-specific code, test on relevant platforms"}),"\n",(0,t.jsx)(s.li,{children:"\u2705 For performance-critical code, run benchmarks"}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["Sources: ",(0,t.jsx)(s.a,{href:"https://github.com/metacall/core/blob/af9cad19/tools/metacall-build.sh#L71-L79",children:"tools/metacall-build.sh71-79"})," ",(0,t.jsx)(s.a,{href:"https://github.com/metacall/core/blob/af9cad19/tools/metacall-sanitizer.sh#L1-L57",children:"tools/metacall-sanitizer.sh1-57"})]})]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>l,x:()=>d});var i=n(6540);const t={},r=i.createContext(t);function l(e){const s=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function d(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),i.createElement(r.Provider,{value:s},e.children)}}}]);