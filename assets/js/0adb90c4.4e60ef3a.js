"use strict";(globalThis.webpackChunkmetacall_doc=globalThis.webpackChunkmetacall_doc||[]).push([[6666],{6500:(e,i,t)=>{t.r(i),t.d(i,{assets:()=>r,contentTitle:()=>s,default:()=>h,frontMatter:()=>o,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"metacall-core/initialization-and-shutdown","title":"Initialization and Shutdown","description":"Relevant source files","source":"@site/docs/metacall-core/initialization-and-shutdown.md","sourceDirName":"metacall-core","slug":"/metacall-core/initialization-and-shutdown","permalink":"/doc/docs/metacall-core/initialization-and-shutdown","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Initialization and Shutdown"},"sidebar":"tutorialSidebar","previous":{"title":"Go Port","permalink":"/doc/docs/metacall-core/go-port"},"next":{"title":"Java Loader","permalink":"/doc/docs/metacall-core/java-loader"}}');var a=t(4848),l=t(8453);const o={title:"Initialization and Shutdown"},s="Initialization and Shutdown",r={},c=[{value:"Relevant source files",id:"relevant-source-files",level:2},{value:"Core Initialization Process",id:"core-initialization-process",level:2},{value:"Basic Initialization",id:"basic-initialization",level:3},{value:"Extended Initialization with Configuration",id:"extended-initialization-with-configuration",level:3},{value:"Command-line Arguments",id:"command-line-arguments",level:3},{value:"Auto-initialization Mechanism",id:"auto-initialization-mechanism",level:3},{value:"Node.js Initialization",id:"nodejs-initialization",level:2},{value:"Shutdown Process",id:"shutdown-process",level:2},{value:"Loader Initialization and Destruction",id:"loader-initialization-and-destruction",level:2},{value:"Checking Initialization Status",id:"checking-initialization-status",level:2},{value:"Settings Flags During Initialization",id:"settings-flags-during-initialization",level:2},{value:"Initialization and Shutdown in C/C++",id:"initialization-and-shutdown-in-cc",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Lifecycle Diagram",id:"lifecycle-diagram",level:2},{value:"Value Validation During Operations",id:"value-validation-during-operations",level:2},{value:"Troubleshooting Initialization Issues",id:"troubleshooting-initialization-issues",level:2}];function d(e){const i={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(i.header,{children:(0,a.jsx)(i.h1,{id:"initialization-and-shutdown",children:"Initialization and Shutdown"})}),"\n",(0,a.jsx)(i.h2,{id:"relevant-source-files",children:"Relevant source files"}),"\n",(0,a.jsxs)(i.ul,{children:["\n",(0,a.jsx)(i.li,{children:(0,a.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/cmake/FindMetaCall.cmake",children:"cmake/FindMetaCall.cmake"})}),"\n",(0,a.jsx)(i.li,{children:(0,a.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/cmake/FindV8.cmake",children:"cmake/FindV8.cmake"})}),"\n",(0,a.jsx)(i.li,{children:(0,a.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loader/include/loader/loader.h",children:"source/loader/include/loader/loader.h"})}),"\n",(0,a.jsx)(i.li,{children:(0,a.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loader/include/loader/loader_impl.h",children:"source/loader/include/loader/loader_impl.h"})}),"\n",(0,a.jsx)(i.li,{children:(0,a.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loader/include/loader/loader_impl_interface.h",children:"source/loader/include/loader/loader_impl_interface.h"})}),"\n",(0,a.jsx)(i.li,{children:(0,a.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loader/source/loader.c",children:"source/loader/source/loader.c"})}),"\n",(0,a.jsx)(i.li,{children:(0,a.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loader/source/loader_impl.c",children:"source/loader/source/loader_impl.c"})}),"\n",(0,a.jsx)(i.li,{children:(0,a.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/node_loader/include/node_loader/node_loader_port.h",children:"source/loaders/node_loader/include/node_loader/node_loader_port.h"})}),"\n",(0,a.jsx)(i.li,{children:(0,a.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/metacall/include/metacall/metacall.h",children:"source/metacall/include/metacall/metacall.h"})}),"\n",(0,a.jsx)(i.li,{children:(0,a.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/metacall/source/metacall.c",children:"source/metacall/source/metacall.c"})}),"\n",(0,a.jsx)(i.li,{children:(0,a.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/ports/node_port/.gitignore",children:"source/ports/node_port/.gitignore"})}),"\n",(0,a.jsx)(i.li,{children:(0,a.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/ports/node_port/.npmignore",children:"source/ports/node_port/.npmignore"})}),"\n",(0,a.jsx)(i.li,{children:(0,a.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/ports/node_port/LICENSE",children:"source/ports/node_port/LICENSE"})}),"\n",(0,a.jsx)(i.li,{children:(0,a.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/ports/node_port/README.md",children:"source/ports/node_port/README.md"})}),"\n",(0,a.jsx)(i.li,{children:(0,a.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/ports/node_port/index.js",children:"source/ports/node_port/index.js"})}),"\n",(0,a.jsx)(i.li,{children:(0,a.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/ports/node_port/package-lock.json",children:"source/ports/node_port/package-lock.json"})}),"\n",(0,a.jsx)(i.li,{children:(0,a.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/ports/node_port/package.json",children:"source/ports/node_port/package.json"})}),"\n",(0,a.jsx)(i.li,{children:(0,a.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/ports/node_port/test/index.js",children:"source/ports/node_port/test/index.js"})}),"\n",(0,a.jsx)(i.li,{children:(0,a.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/reflect/include/reflect/reflect_value.h",children:"source/reflect/include/reflect/reflect_value.h"})}),"\n",(0,a.jsx)(i.li,{children:(0,a.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/reflect/source/reflect_value.c",children:"source/reflect/source/reflect_value.c"})}),"\n",(0,a.jsx)(i.li,{children:(0,a.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/scripts/python/function/source/function.py",children:"source/scripts/python/function/source/function.py"})}),"\n",(0,a.jsx)(i.li,{children:(0,a.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/tests/memcheck/valgrind-suppressions.sh",children:"source/tests/memcheck/valgrind-suppressions.sh"})}),"\n",(0,a.jsx)(i.li,{children:(0,a.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/tests/metacall_function_test/source/metacall_function_test.cpp",children:"source/tests/metacall_function_test/source/metacall_function_test.cpp"})}),"\n",(0,a.jsx)(i.li,{children:(0,a.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/tests/metacall_node_reentrant_test/CMakeLists.txt",children:"source/tests/metacall_node_reentrant_test/CMakeLists.txt"})}),"\n",(0,a.jsx)(i.li,{children:(0,a.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/tests/metacall_python_reentrant_test/source/metacall_python_reentrant_test.cpp",children:"source/tests/metacall_python_reentrant_test/source/metacall_python_reentrant_test.cpp"})}),"\n",(0,a.jsx)(i.li,{children:(0,a.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/tests/metacall_test/source/metacall_test.cpp",children:"source/tests/metacall_test/source/metacall_test.cpp"})}),"\n"]}),"\n",(0,a.jsx)(i.p,{children:"This page documents the initialization and shutdown procedures for the MetaCall runtime environment across different programming languages. Proper initialization is essential for setting up the runtime environment before making cross-language function calls, while orderly shutdown ensures resources are released correctly."}),"\n",(0,a.jsx)(i.h2,{id:"core-initialization-process",children:"Core Initialization Process"}),"\n",(0,a.jsx)(i.p,{children:"MetaCall employs a lifecycle management system that requires initialization before use and proper shutdown to prevent resource leaks. The initialization flow sets up multiple subsystems including logging, dynamic loading, type conversion, and serialization."}),"\n",(0,a.jsx)(i.h3,{id:"basic-initialization",children:"Basic Initialization"}),"\n",(0,a.jsxs)(i.p,{children:["The simplest way to initialize MetaCall is by calling ",(0,a.jsx)(i.code,{children:"metacall_initialize()"}),", which prepares the runtime environment with default settings:"]}),"\n",(0,a.jsx)(i.h3,{id:"extended-initialization-with-configuration",children:"Extended Initialization with Configuration"}),"\n",(0,a.jsxs)(i.p,{children:["For more control over the initialization process, ",(0,a.jsx)(i.code,{children:"metacall_initialize_ex()"})," accepts configuration options to customize loader behavior:"]}),"\n",(0,a.jsx)(i.p,{children:"This allows you to pass language-specific configuration options to each loader during initialization."}),"\n",(0,a.jsx)(i.h3,{id:"command-line-arguments",children:"Command-line Arguments"}),"\n",(0,a.jsx)(i.p,{children:"When running MetaCall as an application, you can pass command-line arguments using:"}),"\n",(0,a.jsx)(i.p,{children:"These arguments are available to the runtimes that may need them."}),"\n",(0,a.jsx)(i.h3,{id:"auto-initialization-mechanism",children:"Auto-initialization Mechanism"}),"\n",(0,a.jsx)(i.p,{children:"MetaCall employs a constructor mechanism that automatically initializes when loaded as a library:"}),"\n",(0,a.jsx)(i.h2,{id:"nodejs-initialization",children:"Node.js Initialization"}),"\n",(0,a.jsx)(i.p,{children:"The Node.js port demonstrates how initialization works in a language-specific context:"}),"\n",(0,a.jsx)(i.h2,{id:"shutdown-process",children:"Shutdown Process"}),"\n",(0,a.jsx)(i.p,{children:"Proper shutdown is essential to avoid resource leaks. The shutdown process typically follows this sequence:"}),"\n",(0,a.jsx)(i.h2,{id:"loader-initialization-and-destruction",children:"Loader Initialization and Destruction"}),"\n",(0,a.jsx)(i.p,{children:"Loaders are initialized in a specific order and then destroyed in reverse order (LIFO) to ensure proper dependency handling:"}),"\n",(0,a.jsx)(i.h2,{id:"checking-initialization-status",children:"Checking Initialization Status"}),"\n",(0,a.jsx)(i.p,{children:"You can check if MetaCall or a specific loader is initialized using:"}),"\n",(0,a.jsx)(i.h2,{id:"settings-flags-during-initialization",children:"Settings Flags During Initialization"}),"\n",(0,a.jsx)(i.p,{children:"MetaCall supports various flags that can be set before initialization:"}),"\n",(0,a.jsx)(i.h2,{id:"initialization-and-shutdown-in-cc",children:"Initialization and Shutdown in C/C++"}),"\n",(0,a.jsx)(i.p,{children:"Example of proper initialization and shutdown in C/C++:"}),"\n",(0,a.jsx)(i.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,a.jsxs)(i.ol,{children:["\n",(0,a.jsxs)(i.li,{children:[(0,a.jsx)(i.strong,{children:"Always check initialization result"}),": MetaCall functions return 0 on success and non-zero on error."]}),"\n",(0,a.jsxs)(i.li,{children:[(0,a.jsx)(i.strong,{children:"Register shutdown handlers"}),": In many contexts, you can register ",(0,a.jsx)(i.code,{children:"metacall_destroy()"})," with ",(0,a.jsx)(i.code,{children:"atexit()"})," to ensure resources are cleaned up."]}),"\n",(0,a.jsxs)(i.li,{children:[(0,a.jsx)(i.strong,{children:"Handle host environments"}),": When integrating MetaCall with an existing language runtime, use the host environment configuration:"]}),"\n",(0,a.jsxs)(i.li,{children:[(0,a.jsx)(i.strong,{children:"Initialize once"}),": MetaCall has protections against multiple initializations, but it's still good practice to check before initializing:"]}),"\n",(0,a.jsxs)(i.li,{children:[(0,a.jsx)(i.strong,{children:"Loader-specific path initialization"}),": Set execution paths for loaders before loading code:"]}),"\n"]}),"\n",(0,a.jsx)(i.h2,{id:"lifecycle-diagram",children:"Lifecycle Diagram"}),"\n",(0,a.jsx)(i.p,{children:"The complete lifecycle of a MetaCall application follows this pattern:"}),"\n",(0,a.jsx)(i.h2,{id:"value-validation-during-operations",children:"Value Validation During Operations"}),"\n",(0,a.jsx)(i.p,{children:"MetaCall checks value validity during operations to detect potential memory corruption or use-after-free scenarios:"}),"\n",(0,a.jsx)(i.h2,{id:"troubleshooting-initialization-issues",children:"Troubleshooting Initialization Issues"}),"\n",(0,a.jsx)(i.p,{children:"Common initialization issues and solutions:"}),"\n",(0,a.jsxs)(i.table,{children:[(0,a.jsx)(i.thead,{children:(0,a.jsxs)(i.tr,{children:[(0,a.jsx)(i.th,{children:"Issue"}),(0,a.jsx)(i.th,{children:"Possible Cause"}),(0,a.jsx)(i.th,{children:"Solution"})]})}),(0,a.jsxs)(i.tbody,{children:[(0,a.jsxs)(i.tr,{children:[(0,a.jsxs)(i.td,{children:["Function returns ",(0,a.jsx)(i.code,{children:"NULL"})]}),(0,a.jsx)(i.td,{children:"MetaCall not initialized"}),(0,a.jsxs)(i.td,{children:["Call ",(0,a.jsx)(i.code,{children:"metacall_initialize()"})," before using MetaCall functions"]})]}),(0,a.jsxs)(i.tr,{children:[(0,a.jsx)(i.td,{children:"Loader fails to initialize"}),(0,a.jsx)(i.td,{children:"Missing dependencies"}),(0,a.jsx)(i.td,{children:"Check if language runtime is properly installed"})]}),(0,a.jsxs)(i.tr,{children:[(0,a.jsx)(i.td,{children:"Memory leaks"}),(0,a.jsxs)(i.td,{children:["Missing ",(0,a.jsx)(i.code,{children:"metacall_destroy()"})]}),(0,a.jsxs)(i.td,{children:["Ensure proper shutdown or register with ",(0,a.jsx)(i.code,{children:"atexit()"})]})]}),(0,a.jsxs)(i.tr,{children:[(0,a.jsx)(i.td,{children:"Crashes during initialization"}),(0,a.jsx)(i.td,{children:"Conflicting runtimes"}),(0,a.jsxs)(i.td,{children:["Use ",(0,a.jsx)(i.code,{children:"METACALL_HOST"})," environment variable"]})]}),(0,a.jsxs)(i.tr,{children:[(0,a.jsx)(i.td,{children:"File loading errors"}),(0,a.jsx)(i.td,{children:"Incorrect execution path"}),(0,a.jsxs)(i.td,{children:["Set correct path with ",(0,a.jsx)(i.code,{children:"metacall_execution_path()"})]})]}),(0,a.jsxs)(i.tr,{children:[(0,a.jsxs)(i.td,{children:["Sources: ",(0,a.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/metacall/source/metacall.c#L222-L341",children:"source/metacall/source/metacall.c222-341"})," ",(0,a.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loader/source/loader_impl.c#L391-L511",children:"source/loader/source/loader_impl.c391-511"})]}),(0,a.jsx)(i.td,{}),(0,a.jsx)(i.td,{})]})]})]})]})}function h(e={}){const{wrapper:i}={...(0,l.R)(),...e.components};return i?(0,a.jsx)(i,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453:(e,i,t)=>{t.d(i,{R:()=>o,x:()=>s});var n=t(6540);const a={},l=n.createContext(a);function o(e){const i=n.useContext(l);return n.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function s(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),n.createElement(l.Provider,{value:i},e.children)}}}]);