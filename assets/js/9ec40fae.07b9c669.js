"use strict";(globalThis.webpackChunkmetacall_doc=globalThis.webpackChunkmetacall_doc||[]).push([[1984],{6640:(e,r,l)=>{l.r(r),l.d(r,{assets:()=>t,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>n,toc:()=>i});const n=JSON.parse('{"id":"metacall-core/error-handling","title":"Error Handling","description":"Relevant source files","source":"@site/docs/metacall-core/error-handling.md","sourceDirName":"metacall-core","slug":"/metacall-core/error-handling","permalink":"/doc/docs/metacall-core/error-handling","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Error Handling"},"sidebar":"tutorialSidebar","previous":{"title":"Docker Builds","permalink":"/doc/docs/metacall-core/docker-builds"},"next":{"title":"Features and Capabilities","permalink":"/doc/docs/metacall-core/features-and-capabilities"}}');var c=l(4848),s=l(8453);const a={title:"Error Handling"},o="Error Handling",t={},i=[{value:"Relevant source files",id:"relevant-source-files",level:2},{value:"1. Error Representation in MetaCall",id:"1-error-representation-in-metacall",level:2},{value:"1.1. The Exception System",id:"11-the-exception-system",level:3},{value:"2. Error Handling Flow",id:"2-error-handling-flow",level:2},{value:"2.1. Error Propagation Across Language Boundaries",id:"21-error-propagation-across-language-boundaries",level:3},{value:"3. Error Checking Patterns",id:"3-error-checking-patterns",level:2},{value:"3.1. Return Code Checking",id:"31-return-code-checking",level:3},{value:"3.2. NULL Return Checking",id:"32-null-return-checking",level:3},{value:"3.3. Error Logging",id:"33-error-logging",level:3},{value:"4. Error Handling in Different Contexts",id:"4-error-handling-in-different-contexts",level:2},{value:"4.1. Error Handling in API Functions",id:"41-error-handling-in-api-functions",level:3},{value:"4.2. Error Handling in Language Loaders",id:"42-error-handling-in-language-loaders",level:3},{value:"5. Best Practices for Error Handling",id:"5-best-practices-for-error-handling",level:2},{value:"5.1 Example Error Handling Pattern",id:"51-example-error-handling-pattern",level:3},{value:"6. Error Handling Implementation Details",id:"6-error-handling-implementation-details",level:2},{value:"6.1. Exception Implementation",id:"61-exception-implementation",level:3},{value:"6.2. Function Call Error Handling",id:"62-function-call-error-handling",level:3},{value:"7. Cross-Language Error Handling",id:"7-cross-language-error-handling",level:2},{value:"7.1. Python Errors",id:"71-python-errors",level:3},{value:"7.2. Ruby Errors",id:"72-ruby-errors",level:3},{value:"7.3. Node.js/JavaScript Errors",id:"73-nodejsjavascript-errors",level:3},{value:"8. Conclusion",id:"8-conclusion",level:2}];function d(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(r.header,{children:(0,c.jsx)(r.h1,{id:"error-handling",children:"Error Handling"})}),"\n",(0,c.jsx)(r.h2,{id:"relevant-source-files",children:"Relevant source files"}),"\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsx)(r.li,{children:(0,c.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/cmake/FindV8.cmake",children:"cmake/FindV8.cmake"})}),"\n",(0,c.jsx)(r.li,{children:(0,c.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loader/include/loader/loader.h",children:"source/loader/include/loader/loader.h"})}),"\n",(0,c.jsx)(r.li,{children:(0,c.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loader/include/loader/loader_impl.h",children:"source/loader/include/loader/loader_impl.h"})}),"\n",(0,c.jsx)(r.li,{children:(0,c.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loader/include/loader/loader_impl_interface.h",children:"source/loader/include/loader/loader_impl_interface.h"})}),"\n",(0,c.jsx)(r.li,{children:(0,c.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loader/source/loader.c",children:"source/loader/source/loader.c"})}),"\n",(0,c.jsx)(r.li,{children:(0,c.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loader/source/loader_impl.c",children:"source/loader/source/loader_impl.c"})}),"\n",(0,c.jsx)(r.li,{children:(0,c.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/rb_loader/source/rb_loader_impl.c",children:"source/loaders/rb_loader/source/rb_loader_impl.c"})}),"\n",(0,c.jsx)(r.li,{children:(0,c.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/rb_loader/source/rb_loader_impl_parser.c",children:"source/loaders/rb_loader/source/rb_loader_impl_parser.c"})}),"\n",(0,c.jsx)(r.li,{children:(0,c.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/metacall/include/metacall/metacall.h",children:"source/metacall/include/metacall/metacall.h"})}),"\n",(0,c.jsx)(r.li,{children:(0,c.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/metacall/include/metacall/metacall_error.h",children:"source/metacall/include/metacall/metacall_error.h"})}),"\n",(0,c.jsx)(r.li,{children:(0,c.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/metacall/source/metacall.c",children:"source/metacall/source/metacall.c"})}),"\n",(0,c.jsx)(r.li,{children:(0,c.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/metacall/source/metacall_error.c",children:"source/metacall/source/metacall_error.c"})}),"\n",(0,c.jsx)(r.li,{children:(0,c.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/reflect/include/reflect/reflect_accessor.h",children:"source/reflect/include/reflect/reflect_accessor.h"})}),"\n",(0,c.jsx)(r.li,{children:(0,c.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/reflect/include/reflect/reflect_class.h",children:"source/reflect/include/reflect/reflect_class.h"})}),"\n",(0,c.jsx)(r.li,{children:(0,c.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/reflect/include/reflect/reflect_exception.h",children:"source/reflect/include/reflect/reflect_exception.h"})}),"\n",(0,c.jsx)(r.li,{children:(0,c.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/reflect/include/reflect/reflect_object.h",children:"source/reflect/include/reflect/reflect_object.h"})}),"\n",(0,c.jsx)(r.li,{children:(0,c.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/reflect/source/reflect_class.c",children:"source/reflect/source/reflect_class.c"})}),"\n",(0,c.jsx)(r.li,{children:(0,c.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/reflect/source/reflect_exception.c",children:"source/reflect/source/reflect_exception.c"})}),"\n",(0,c.jsx)(r.li,{children:(0,c.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/reflect/source/reflect_object.c",children:"source/reflect/source/reflect_object.c"})}),"\n",(0,c.jsx)(r.li,{children:(0,c.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/scripts/python/classname/CMakeLists.txt",children:"source/scripts/python/classname/CMakeLists.txt"})}),"\n",(0,c.jsx)(r.li,{children:(0,c.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/scripts/python/classname/depends/__init__.py",children:"source/scripts/python/classname/depends/__init__.py"})}),"\n",(0,c.jsx)(r.li,{children:(0,c.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/scripts/python/classname/source/classname.py",children:"source/scripts/python/classname/source/classname.py"})}),"\n",(0,c.jsx)(r.li,{children:(0,c.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/scripts/ruby/klass/source/klass.rb",children:"source/scripts/ruby/klass/source/klass.rb"})}),"\n",(0,c.jsx)(r.li,{children:(0,c.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/tests/metacall_python_object_class_test/source/metacall_python_object_class_test.cpp",children:"source/tests/metacall_python_object_class_test/source/metacall_python_object_class_test.cpp"})}),"\n",(0,c.jsx)(r.li,{children:(0,c.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/tests/metacall_ruby_object_class_test/source/metacall_ruby_object_class_test.cpp",children:"source/tests/metacall_ruby_object_class_test/source/metacall_ruby_object_class_test.cpp"})}),"\n",(0,c.jsx)(r.li,{children:(0,c.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/tests/metacall_test/source/metacall_test.cpp",children:"source/tests/metacall_test/source/metacall_test.cpp"})}),"\n",(0,c.jsx)(r.li,{children:(0,c.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/tests/reflect_object_class_test/source/reflect_object_class_test.cpp",children:"source/tests/reflect_object_class_test/source/reflect_object_class_test.cpp"})}),"\n",(0,c.jsx)(r.li,{children:(0,c.jsx)(r.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/threading/CMakeLists.txt",children:"source/threading/CMakeLists.txt"})}),"\n"]}),"\n",(0,c.jsx)(r.p,{children:"This page documents the error handling mechanisms in MetaCall Core, explaining how errors are represented, propagated, and handled across language boundaries. It covers the exception system, return codes, error logging, and best practices for handling errors when using MetaCall."}),"\n",(0,c.jsx)(r.h2,{id:"1-error-representation-in-metacall",children:"1. Error Representation in MetaCall"}),"\n",(0,c.jsx)(r.p,{children:"MetaCall uses several approaches for error representation:"}),"\n",(0,c.jsxs)(r.ol,{children:["\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Return Codes"}),": Most functions return an integer status code (0 for success, non-zero for error)."]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"NULL Returns"}),": Functions that return pointers often return ",(0,c.jsx)(r.code,{children:"NULL"})," to indicate errors."]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Exceptions"}),": A structured exception system to represent detailed error information."]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Logging"}),": Error messages are logged through MetaCall's logging system."]}),"\n"]}),"\n",(0,c.jsx)(r.h3,{id:"11-the-exception-system",children:"1.1. The Exception System"}),"\n",(0,c.jsxs)(r.p,{children:["MetaCall implements a cross-language exception system through the ",(0,c.jsx)(r.code,{children:"exception"})," type, designed to capture error information regardless of source language."]}),"\n",(0,c.jsxs)(r.p,{children:["The ",(0,c.jsx)(r.code,{children:"exception"})," type contains:"]}),"\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.code,{children:"message"}),": Descriptive error message"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.code,{children:"label"}),": Error type or category"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.code,{children:"code"}),": Numeric error code"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.code,{children:"stacktrace"}),": Stack trace from where the error originated"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.code,{children:"id"}),": Thread ID where the error was raised"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.code,{children:"ref"}),": Reference counter for memory management"]}),"\n"]}),"\n",(0,c.jsx)(r.h2,{id:"2-error-handling-flow",children:"2. Error Handling Flow"}),"\n",(0,c.jsx)(r.p,{children:"Error handling in MetaCall follows a general pattern that allows errors to be propagated across language boundaries."}),"\n",(0,c.jsx)(r.h3,{id:"21-error-propagation-across-language-boundaries",children:"2.1. Error Propagation Across Language Boundaries"}),"\n",(0,c.jsx)(r.p,{children:"When an error occurs in a function executed through MetaCall, it's captured and propagated back through the call chain:"}),"\n",(0,c.jsxs)(r.ol,{children:["\n",(0,c.jsx)(r.li,{children:"The language-specific loader captures the error in the runtime's native format"}),"\n",(0,c.jsx)(r.li,{children:"The error is translated to a MetaCall representation"}),"\n",(0,c.jsx)(r.li,{children:"The error is returned to the caller, either as a return code or exception"}),"\n"]}),"\n",(0,c.jsx)(r.h2,{id:"3-error-checking-patterns",children:"3. Error Checking Patterns"}),"\n",(0,c.jsx)(r.h3,{id:"31-return-code-checking",children:"3.1. Return Code Checking"}),"\n",(0,c.jsx)(r.p,{children:"Most MetaCall API functions return status codes that should be checked:"}),"\n",(0,c.jsx)(r.p,{children:"Common functions that return status codes:"}),"\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsx)(r.li,{children:(0,c.jsx)(r.code,{children:"metacall_initialize()"})}),"\n",(0,c.jsx)(r.li,{children:(0,c.jsx)(r.code,{children:"metacall_load_from_file()"})}),"\n",(0,c.jsx)(r.li,{children:(0,c.jsx)(r.code,{children:"metacall_load_from_memory()"})}),"\n",(0,c.jsx)(r.li,{children:(0,c.jsx)(r.code,{children:"metacall_execution_path()"})}),"\n"]}),"\n",(0,c.jsx)(r.h3,{id:"32-null-return-checking",children:"3.2. NULL Return Checking"}),"\n",(0,c.jsxs)(r.p,{children:["Functions that return values often return ",(0,c.jsx)(r.code,{children:"NULL"})," on error:"]}),"\n",(0,c.jsxs)(r.p,{children:["Common functions that may return ",(0,c.jsx)(r.code,{children:"NULL"})," on error:"]}),"\n",(0,c.jsxs)(r.ul,{children:["\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.code,{children:"metacall()"}),", ",(0,c.jsx)(r.code,{children:"metacallv()"}),", ",(0,c.jsx)(r.code,{children:"metacallt()"})]}),"\n",(0,c.jsx)(r.li,{children:(0,c.jsx)(r.code,{children:"metacall_function()"})}),"\n",(0,c.jsx)(r.li,{children:"Various value-returning functions"}),"\n"]}),"\n",(0,c.jsx)(r.h3,{id:"33-error-logging",children:"3.3. Error Logging"}),"\n",(0,c.jsxs)(r.p,{children:["Errors are logged through MetaCall's logging system. The default log output is ",(0,c.jsx)(r.code,{children:"stdout"}),", but this can be configured:"]}),"\n",(0,c.jsx)(r.h2,{id:"4-error-handling-in-different-contexts",children:"4. Error Handling in Different Contexts"}),"\n",(0,c.jsx)(r.h3,{id:"41-error-handling-in-api-functions",children:"4.1. Error Handling in API Functions"}),"\n",(0,c.jsx)(r.p,{children:"The MetaCall API itself uses consistent error handling patterns:"}),"\n",(0,c.jsx)(r.p,{children:"Common error handling patterns in API functions:"}),"\n",(0,c.jsxs)(r.ol,{children:["\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Early return"}),": Check conditions and return early on error"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Logging"}),": Log detailed error information for diagnostics"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Cleanup"}),": Free resources before returning error status"]}),"\n"]}),"\n",(0,c.jsx)(r.h3,{id:"42-error-handling-in-language-loaders",children:"4.2. Error Handling in Language Loaders"}),"\n",(0,c.jsx)(r.p,{children:"Language loaders handle errors specific to their runtime:"}),"\n",(0,c.jsxs)(r.ol,{children:["\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Python Loader"}),": Captures Python exceptions and converts them to MetaCall errors"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Ruby Loader"}),": Uses ",(0,c.jsx)(r.code,{children:"rb_protect"})," to safely call Ruby methods and capture exceptions"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Node.js Loader"}),": Converts JavaScript exceptions to MetaCall errors"]}),"\n"]}),"\n",(0,c.jsx)(r.h2,{id:"5-best-practices-for-error-handling",children:"5. Best Practices for Error Handling"}),"\n",(0,c.jsx)(r.p,{children:"When using MetaCall, follow these error handling best practices:"}),"\n",(0,c.jsxs)(r.ol,{children:["\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Always check return codes"})," of MetaCall API functions"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Validate pointers"})," returned from MetaCall before using them"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Properly destroy values"})," to avoid memory leaks, especially when handling errors"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Configure appropriate logging"})," to capture error details"]}),"\n",(0,c.jsxs)(r.li,{children:[(0,c.jsx)(r.strong,{children:"Handle language-specific exceptions"})," when working with language ports"]}),"\n"]}),"\n",(0,c.jsx)(r.h3,{id:"51-example-error-handling-pattern",children:"5.1 Example Error Handling Pattern"}),"\n",(0,c.jsx)(r.p,{children:"A robust error handling pattern for MetaCall:"}),"\n",(0,c.jsx)(r.h2,{id:"6-error-handling-implementation-details",children:"6. Error Handling Implementation Details"}),"\n",(0,c.jsx)(r.h3,{id:"61-exception-implementation",children:"6.1. Exception Implementation"}),"\n",(0,c.jsxs)(r.p,{children:["The ",(0,c.jsx)(r.code,{children:"exception"})," type uses reference counting for memory management:"]}),"\n",(0,c.jsx)(r.p,{children:"When the reference count reaches zero, the exception is destroyed, freeing all allocated memory."}),"\n",(0,c.jsx)(r.h3,{id:"62-function-call-error-handling",children:"6.2. Function Call Error Handling"}),"\n",(0,c.jsxs)(r.p,{children:["When a function is called through ",(0,c.jsx)(r.code,{children:"metacall()"}),", errors are handled as follows:"]}),"\n",(0,c.jsxs)(r.ol,{children:["\n",(0,c.jsx)(r.li,{children:"Arguments are validated"}),"\n",(0,c.jsx)(r.li,{children:"The function is looked up"}),"\n",(0,c.jsxs)(r.li,{children:["If the function is not found, ",(0,c.jsx)(r.code,{children:"NULL"})," is returned"]}),"\n",(0,c.jsx)(r.li,{children:"The function is called with appropriate error handling"}),"\n",(0,c.jsx)(r.li,{children:"The return value is processed or an error is returned"}),"\n"]}),"\n",(0,c.jsx)(r.h2,{id:"7-cross-language-error-handling",children:"7. Cross-Language Error Handling"}),"\n",(0,c.jsx)(r.p,{children:"MetaCall provides consistent error handling across different programming languages:"}),"\n",(0,c.jsx)(r.h3,{id:"71-python-errors",children:"7.1. Python Errors"}),"\n",(0,c.jsx)(r.p,{children:"Python exceptions are captured and converted to MetaCall errors or exceptions. The Python traceback is preserved and can be accessed through the exception object."}),"\n",(0,c.jsx)(r.h3,{id:"72-ruby-errors",children:"7.2. Ruby Errors"}),"\n",(0,c.jsxs)(r.p,{children:["Ruby errors are captured using Ruby's ",(0,c.jsx)(r.code,{children:"rb_protect"})," mechanism and are converted to MetaCall errors:"]}),"\n",(0,c.jsx)(r.p,{children:"The Ruby loader also includes a macro to print exception details:"}),"\n",(0,c.jsx)(r.h3,{id:"73-nodejsjavascript-errors",children:"7.3. Node.js/JavaScript Errors"}),"\n",(0,c.jsx)(r.p,{children:"JavaScript exceptions are captured using N-API's error handling mechanisms and are converted to MetaCall errors."}),"\n",(0,c.jsx)(r.h2,{id:"8-conclusion",children:"8. Conclusion"}),"\n",(0,c.jsx)(r.p,{children:"MetaCall provides a robust error handling system that works across language boundaries. By consistently checking return codes, validating pointers, and properly managing resources, you can build reliable polyglot applications that gracefully handle errors regardless of the source language."}),"\n",(0,c.jsx)(r.p,{children:"Remember that errors can occur at various levels, from language runtime errors to MetaCall API errors to application logic errors. A good error handling strategy should account for all these possibilities."})]})}function h(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,c.jsx)(r,{...e,children:(0,c.jsx)(d,{...e})}):d(e)}},8453:(e,r,l)=>{l.d(r,{R:()=>a,x:()=>o});var n=l(6540);const c={},s=n.createContext(c);function a(e){const r=n.useContext(s);return n.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:a(e.components),n.createElement(s.Provider,{value:r},e.children)}}}]);