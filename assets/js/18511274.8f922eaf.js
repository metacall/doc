"use strict";(globalThis.webpackChunkmetacall_doc=globalThis.webpackChunkmetacall_doc||[]).push([[9514],{6769:(e,l,c)=>{c.r(l),c.d(l,{assets:()=>s,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>n,toc:()=>i});const n=JSON.parse('{"id":"metacall-core/calling-functions","title":"Calling Functions","description":"Relevant source files","source":"@site/docs/metacall-core/calling-functions.md","sourceDirName":"metacall-core","slug":"/metacall-core/calling-functions","permalink":"/doc/docs/metacall-core/calling-functions","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Calling Functions"},"sidebar":"tutorialSidebar","previous":{"title":"Build System","permalink":"/doc/docs/metacall-core/build-system"},"next":{"title":"CLI Commands","permalink":"/doc/docs/metacall-core/cli-commands"}}');var t=c(4848),o=c(8453);const a={title:"Calling Functions"},r="Calling Functions",s={},i=[{value:"Relevant source files",id:"relevant-source-files",level:2},{value:"Overview of Function Calling in MetaCall",id:"overview-of-function-calling-in-metacall",level:2},{value:"Core Function Call API",id:"core-function-call-api",level:2},{value:"Calling Functions by Name",id:"calling-functions-by-name",level:3},{value:"Calling Functions by Handle",id:"calling-functions-by-handle",level:3},{value:"Calling Functions by Reference",id:"calling-functions-by-reference",level:3},{value:"Serialized Function Calls",id:"serialized-function-calls",level:3},{value:"Function Call Lifecycle",id:"function-call-lifecycle",level:2},{value:"Type Conversion",id:"type-conversion",level:2},{value:"Function Metadata",id:"function-metadata",level:2},{value:"Language-Specific Ports",id:"language-specific-ports",level:2},{value:"Node.js Port",id:"nodejs-port",level:3},{value:"Go Port",id:"go-port",level:3},{value:"Examples",id:"examples",level:2},{value:"Basic Function Call",id:"basic-function-call",level:3},{value:"Function Call with Array Arguments",id:"function-call-with-array-arguments",level:3},{value:"Working with Function References",id:"working-with-function-references",level:3},{value:"Asynchronous Function Calls",id:"asynchronous-function-calls",level:3},{value:"Error Handling",id:"error-handling",level:2},{value:"Best Practices",id:"best-practices",level:2}];function d(e){const l={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.header,{children:(0,t.jsx)(l.h1,{id:"calling-functions",children:"Calling Functions"})}),"\n",(0,t.jsx)(l.h2,{id:"relevant-source-files",children:"Relevant source files"}),"\n",(0,t.jsxs)(l.ul,{children:["\n",(0,t.jsx)(l.li,{children:(0,t.jsx)(l.a,{href:"https://github.com/metacall/core/blob/af9cad19/cmake/FindMetaCall.cmake",children:"cmake/FindMetaCall.cmake"})}),"\n",(0,t.jsx)(l.li,{children:(0,t.jsx)(l.a,{href:"https://github.com/metacall/core/blob/af9cad19/cmake/FindV8.cmake",children:"cmake/FindV8.cmake"})}),"\n",(0,t.jsx)(l.li,{children:(0,t.jsx)(l.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loader/include/loader/loader.h",children:"source/loader/include/loader/loader.h"})}),"\n",(0,t.jsx)(l.li,{children:(0,t.jsx)(l.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loader/include/loader/loader_impl.h",children:"source/loader/include/loader/loader_impl.h"})}),"\n",(0,t.jsx)(l.li,{children:(0,t.jsx)(l.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loader/include/loader/loader_impl_interface.h",children:"source/loader/include/loader/loader_impl_interface.h"})}),"\n",(0,t.jsx)(l.li,{children:(0,t.jsx)(l.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loader/source/loader.c",children:"source/loader/source/loader.c"})}),"\n",(0,t.jsx)(l.li,{children:(0,t.jsx)(l.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loader/source/loader_impl.c",children:"source/loader/source/loader_impl.c"})}),"\n",(0,t.jsx)(l.li,{children:(0,t.jsx)(l.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/node_loader/include/node_loader/node_loader_port.h",children:"source/loaders/node_loader/include/node_loader/node_loader_port.h"})}),"\n",(0,t.jsx)(l.li,{children:(0,t.jsx)(l.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/metacall/include/metacall/metacall.h",children:"source/metacall/include/metacall/metacall.h"})}),"\n",(0,t.jsx)(l.li,{children:(0,t.jsx)(l.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/metacall/source/metacall.c",children:"source/metacall/source/metacall.c"})}),"\n",(0,t.jsx)(l.li,{children:(0,t.jsx)(l.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/ports/go_port/source/README.md",children:"source/ports/go_port/source/README.md"})}),"\n",(0,t.jsx)(l.li,{children:(0,t.jsx)(l.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/ports/go_port/source/await.go",children:"source/ports/go_port/source/await.go"})}),"\n",(0,t.jsx)(l.li,{children:(0,t.jsx)(l.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/ports/go_port/source/go.mod",children:"source/ports/go_port/source/go.mod"})}),"\n",(0,t.jsx)(l.li,{children:(0,t.jsx)(l.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/ports/go_port/source/go.sum",children:"source/ports/go_port/source/go.sum"})}),"\n",(0,t.jsx)(l.li,{children:(0,t.jsx)(l.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/ports/go_port/source/go_port.go",children:"source/ports/go_port/source/go_port.go"})}),"\n",(0,t.jsx)(l.li,{children:(0,t.jsx)(l.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/ports/go_port/source/go_port_test.go",children:"source/ports/go_port/source/go_port_test.go"})}),"\n",(0,t.jsx)(l.li,{children:(0,t.jsx)(l.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/ports/go_port/source/pointer.go",children:"source/ports/go_port/source/pointer.go"})}),"\n",(0,t.jsx)(l.li,{children:(0,t.jsx)(l.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/ports/node_port/.gitignore",children:"source/ports/node_port/.gitignore"})}),"\n",(0,t.jsx)(l.li,{children:(0,t.jsx)(l.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/ports/node_port/.npmignore",children:"source/ports/node_port/.npmignore"})}),"\n",(0,t.jsx)(l.li,{children:(0,t.jsx)(l.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/ports/node_port/LICENSE",children:"source/ports/node_port/LICENSE"})}),"\n",(0,t.jsx)(l.li,{children:(0,t.jsx)(l.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/ports/node_port/README.md",children:"source/ports/node_port/README.md"})}),"\n",(0,t.jsx)(l.li,{children:(0,t.jsx)(l.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/ports/node_port/index.js",children:"source/ports/node_port/index.js"})}),"\n",(0,t.jsx)(l.li,{children:(0,t.jsx)(l.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/ports/node_port/package-lock.json",children:"source/ports/node_port/package-lock.json"})}),"\n",(0,t.jsx)(l.li,{children:(0,t.jsx)(l.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/ports/node_port/package.json",children:"source/ports/node_port/package.json"})}),"\n",(0,t.jsx)(l.li,{children:(0,t.jsx)(l.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/ports/node_port/test/index.js",children:"source/ports/node_port/test/index.js"})}),"\n",(0,t.jsx)(l.li,{children:(0,t.jsx)(l.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/reflect/include/reflect/reflect_value.h",children:"source/reflect/include/reflect/reflect_value.h"})}),"\n",(0,t.jsx)(l.li,{children:(0,t.jsx)(l.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/reflect/source/reflect_value.c",children:"source/reflect/source/reflect_value.c"})}),"\n",(0,t.jsx)(l.li,{children:(0,t.jsx)(l.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/scripts/python/function/source/function.py",children:"source/scripts/python/function/source/function.py"})}),"\n",(0,t.jsx)(l.li,{children:(0,t.jsx)(l.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/tests/memcheck/valgrind-suppressions.sh",children:"source/tests/memcheck/valgrind-suppressions.sh"})}),"\n",(0,t.jsx)(l.li,{children:(0,t.jsx)(l.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/tests/metacall_function_test/source/metacall_function_test.cpp",children:"source/tests/metacall_function_test/source/metacall_function_test.cpp"})}),"\n",(0,t.jsx)(l.li,{children:(0,t.jsx)(l.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/tests/metacall_node_reentrant_test/CMakeLists.txt",children:"source/tests/metacall_node_reentrant_test/CMakeLists.txt"})}),"\n",(0,t.jsx)(l.li,{children:(0,t.jsx)(l.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/tests/metacall_python_reentrant_test/source/metacall_python_reentrant_test.cpp",children:"source/tests/metacall_python_reentrant_test/source/metacall_python_reentrant_test.cpp"})}),"\n",(0,t.jsx)(l.li,{children:(0,t.jsx)(l.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/tests/metacall_test/source/metacall_test.cpp",children:"source/tests/metacall_test/source/metacall_test.cpp"})}),"\n"]}),"\n",(0,t.jsxs)(l.p,{children:["This document explains how to use MetaCall to call functions across language boundaries, including different API variations, argument handling, and value conversion. For information about loading code before calling functions, see ",(0,t.jsx)(l.a,{href:"/doc/docs/metacall-core/loading-code",children:"Loading Code"}),"."]}),"\n",(0,t.jsx)(l.h2,{id:"overview-of-function-calling-in-metacall",children:"Overview of Function Calling in MetaCall"}),"\n",(0,t.jsx)(l.p,{children:"MetaCall provides several ways to call functions across language boundaries. The core API offers different functions based on how you want to pass arguments and how you reference the function you want to call."}),"\n",(0,t.jsx)(l.h2,{id:"core-function-call-api",children:"Core Function Call API"}),"\n",(0,t.jsx)(l.h3,{id:"calling-functions-by-name",children:"Calling Functions by Name"}),"\n",(0,t.jsxs)(l.p,{children:["The simplest way to call functions is using the ",(0,t.jsx)(l.code,{children:"metacall"})," function:"]}),"\n",(0,t.jsx)(l.p,{children:"This function looks up a function by name across all loaded modules and calls it with the provided arguments. For example:"}),"\n",(0,t.jsx)(l.p,{children:"For more control over arguments, there are variants:"}),"\n",(0,t.jsxs)(l.table,{children:[(0,t.jsx)(l.thead,{children:(0,t.jsxs)(l.tr,{children:[(0,t.jsx)(l.th,{children:"Function"}),(0,t.jsx)(l.th,{children:"Description"})]})}),(0,t.jsxs)(l.tbody,{children:[(0,t.jsxs)(l.tr,{children:[(0,t.jsx)(l.td,{children:(0,t.jsx)(l.code,{children:"metacall"})}),(0,t.jsx)(l.td,{children:"Call by name with variable arguments"})]}),(0,t.jsxs)(l.tr,{children:[(0,t.jsx)(l.td,{children:(0,t.jsx)(l.code,{children:"metacallv"})}),(0,t.jsx)(l.td,{children:"Call by name with array of arguments"})]}),(0,t.jsxs)(l.tr,{children:[(0,t.jsx)(l.td,{children:(0,t.jsx)(l.code,{children:"metacallv_s"})}),(0,t.jsx)(l.td,{children:"Call by name with array of arguments and explicit size"})]}),(0,t.jsxs)(l.tr,{children:[(0,t.jsx)(l.td,{children:(0,t.jsx)(l.code,{children:"metacallt"})}),(0,t.jsx)(l.td,{children:"Call by name with explicit argument types"})]}),(0,t.jsxs)(l.tr,{children:[(0,t.jsx)(l.td,{children:(0,t.jsx)(l.code,{children:"metacallt_s"})}),(0,t.jsx)(l.td,{children:"Call by name with explicit argument types and size"})]})]})]}),"\n",(0,t.jsx)(l.h3,{id:"calling-functions-by-handle",children:"Calling Functions by Handle"}),"\n",(0,t.jsx)(l.p,{children:"To avoid name collisions when multiple modules define functions with the same name, you can use handle-specific function calls:"}),"\n",(0,t.jsx)(l.p,{children:"Example:"}),"\n",(0,t.jsx)(l.h3,{id:"calling-functions-by-reference",children:"Calling Functions by Reference"}),"\n",(0,t.jsx)(l.p,{children:"You can also get a function reference first and then call it:"}),"\n",(0,t.jsx)(l.p,{children:"Example:"}),"\n",(0,t.jsx)(l.h3,{id:"serialized-function-calls",children:"Serialized Function Calls"}),"\n",(0,t.jsx)(l.p,{children:"For interoperation with external systems, MetaCall supports serialized function calls:"}),"\n",(0,t.jsx)(l.p,{children:"Example:"}),"\n",(0,t.jsx)(l.h2,{id:"function-call-lifecycle",children:"Function Call Lifecycle"}),"\n",(0,t.jsx)(l.p,{children:"The following diagram shows the sequence of operations when calling a function in MetaCall:"}),"\n",(0,t.jsx)(l.h2,{id:"type-conversion",children:"Type Conversion"}),"\n",(0,t.jsx)(l.p,{children:"When calling functions across language boundaries, MetaCall handles type conversion automatically:"}),"\n",(0,t.jsx)(l.p,{children:"When calling a function, MetaCall will try to convert arguments to the expected types based on the function's signature. If the conversion is not possible, the call may fail."}),"\n",(0,t.jsx)(l.h2,{id:"function-metadata",children:"Function Metadata"}),"\n",(0,t.jsx)(l.p,{children:"You can inspect function metadata to understand its parameters and return type:"}),"\n",(0,t.jsx)(l.p,{children:"Example:"}),"\n",(0,t.jsx)(l.h2,{id:"language-specific-ports",children:"Language-Specific Ports"}),"\n",(0,t.jsx)(l.p,{children:"Each language port provides a more idiomatic way to call functions."}),"\n",(0,t.jsx)(l.h3,{id:"nodejs-port",children:"Node.js Port"}),"\n",(0,t.jsx)(l.p,{children:"In Node.js, you can call functions like this:"}),"\n",(0,t.jsx)(l.p,{children:"You can also import functions directly:"}),"\n",(0,t.jsx)(l.h3,{id:"go-port",children:"Go Port"}),"\n",(0,t.jsx)(l.p,{children:"In Go, you can call functions like this:"}),"\n",(0,t.jsx)(l.h2,{id:"examples",children:"Examples"}),"\n",(0,t.jsx)(l.h3,{id:"basic-function-call",children:"Basic Function Call"}),"\n",(0,t.jsx)(l.h3,{id:"function-call-with-array-arguments",children:"Function Call with Array Arguments"}),"\n",(0,t.jsx)(l.h3,{id:"working-with-function-references",children:"Working with Function References"}),"\n",(0,t.jsx)(l.h3,{id:"asynchronous-function-calls",children:"Asynchronous Function Calls"}),"\n",(0,t.jsx)(l.p,{children:"For asynchronous functions (like JavaScript Promises), you can check the async status and use futures:"}),"\n",(0,t.jsx)(l.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,t.jsx)(l.p,{children:"When a function call fails, there are several possible causes:"}),"\n",(0,t.jsxs)(l.ol,{children:["\n",(0,t.jsx)(l.li,{children:"The function doesn't exist"}),"\n",(0,t.jsx)(l.li,{children:"The arguments are incompatible with the function's signature"}),"\n",(0,t.jsx)(l.li,{children:"The function threw an exception"}),"\n"]}),"\n",(0,t.jsxs)(l.p,{children:["In the C API, function call failures are indicated by returning ",(0,t.jsx)(l.code,{children:"NULL"}),". In language-specific ports, errors may be propagated as exceptions or error objects according to the language's conventions."]}),"\n",(0,t.jsx)(l.p,{children:"Always check for errors when making function calls across language boundaries."}),"\n",(0,t.jsx)(l.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsxs)(l.ol,{children:["\n",(0,t.jsxs)(l.li,{children:[(0,t.jsx)(l.strong,{children:"Clean up memory"}),": Always destroy MetaCall values with ",(0,t.jsx)(l.code,{children:"metacall_value_destroy"})," when you're done with them."]}),"\n",(0,t.jsxs)(l.li,{children:[(0,t.jsx)(l.strong,{children:"Use handle-specific calls"}),": When working with multiple modules that might define functions with the same name, use handle-specific functions like ",(0,t.jsx)(l.code,{children:"metacallhv"}),"."]}),"\n",(0,t.jsxs)(l.li,{children:[(0,t.jsx)(l.strong,{children:"Check function metadata"}),": Before calling a function, you can inspect its parameters and return type to ensure compatibility."]}),"\n",(0,t.jsxs)(l.li,{children:[(0,t.jsx)(l.strong,{children:"Prefer language-specific ports"}),": When possible, use the language-specific port API for more idiomatic code."]}),"\n",(0,t.jsxs)(l.li,{children:[(0,t.jsx)(l.strong,{children:"Handle errors"}),": Always check for and handle errors when making cross-language function calls."]}),"\n",(0,t.jsxs)(l.li,{children:[(0,t.jsx)(l.strong,{children:"Be mindful of type conversions"}),": While MetaCall handles type conversions automatically, be aware of potential issues with complex types or language-specific behaviors."]}),"\n"]}),"\n",(0,t.jsxs)(l.p,{children:["Sources: ",(0,t.jsx)(l.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/metacall/source/metacall.c#L1126-L1188",children:"source/metacall/source/metacall.c1126-1188"})," ",(0,t.jsx)(l.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/metacall/source/metacall.c#L516-L554",children:"source/metacall/source/metacall.c516-554"})," ",(0,t.jsx)(l.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/metacall/source/metacall.c#L1019-L1081",children:"source/metacall/source/metacall.c1019-1081"})]})]})}function h(e={}){const{wrapper:l}={...(0,o.R)(),...e.components};return l?(0,t.jsx)(l,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,l,c)=>{c.d(l,{R:()=>a,x:()=>r});var n=c(6540);const t={},o=n.createContext(t);function a(e){const l=n.useContext(o);return n.useMemo(function(){return"function"==typeof e?e(l):{...l,...e}},[l,e])}function r(e){let l;return l=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),n.createElement(o.Provider,{value:l},e.children)}}}]);