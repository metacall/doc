"use strict";(globalThis.webpackChunkmetacall_doc=globalThis.webpackChunkmetacall_doc||[]).push([[9497],{8453:(e,i,l)=>{l.d(i,{R:()=>r,x:()=>t});var n=l(6540);const c={},s=n.createContext(c);function r(e){const i=n.useContext(s);return n.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function t(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:r(e.components),n.createElement(s.Provider,{value:i},e.children)}},8824:(e,i,l)=>{l.r(i),l.d(i,{assets:()=>a,contentTitle:()=>t,default:()=>h,frontMatter:()=>r,metadata:()=>n,toc:()=>o});const n=JSON.parse('{"id":"metacall-core/repl-mode","title":"REPL Mode","description":"Relevant source files","source":"@site/docs/metacall-core/repl-mode.md","sourceDirName":"metacall-core","slug":"/metacall-core/repl-mode","permalink":"/doc/docs/metacall-core/repl-mode","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"REPL Mode"},"sidebar":"tutorialSidebar","previous":{"title":"Python Port","permalink":"/doc/docs/metacall-core/python-port"},"next":{"title":"Ruby Loader","permalink":"/doc/docs/metacall-core/ruby-loader"}}');var c=l(4848),s=l(8453);const r={title:"REPL Mode"},t="REPL Mode",a={},o=[{value:"Relevant source files",id:"relevant-source-files",level:2},{value:"Overview",id:"overview",level:2},{value:"Architecture",id:"architecture",level:2},{value:"REPL System Components",id:"repl-system-components",level:3},{value:"REPL Execution Flow",id:"repl-execution-flow",level:3},{value:"Initialization Process",id:"initialization-process",level:2},{value:"Command Processing",id:"command-processing",level:2},{value:"Command Format",id:"command-format",level:3},{value:"Command Registration and Parsing",id:"command-registration-and-parsing",level:3},{value:"Command Execution Flow",id:"command-execution-flow",level:3},{value:"Plugin System",id:"plugin-system",level:2},{value:"REPL Implementation Details",id:"repl-implementation-details",level:2},{value:"REPL Promise Chain",id:"repl-promise-chain",level:2},{value:"Error Handling",id:"error-handling",level:2},{value:"Exiting the REPL",id:"exiting-the-repl",level:2},{value:"Available Commands",id:"available-commands",level:2},{value:"Example Usage",id:"example-usage",level:2}];function d(e){const i={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(i.header,{children:(0,c.jsx)(i.h1,{id:"repl-mode",children:"REPL Mode"})}),"\n",(0,c.jsx)(i.h2,{id:"relevant-source-files",children:"Relevant source files"}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsx)(i.li,{children:(0,c.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/cli/metacallcli/include/metacallcli/application.hpp",children:"source/cli/metacallcli/include/metacallcli/application.hpp"})}),"\n",(0,c.jsx)(i.li,{children:(0,c.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/cli/metacallcli/source/application.cpp",children:"source/cli/metacallcli/source/application.cpp"})}),"\n",(0,c.jsx)(i.li,{children:(0,c.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/cli/metacallcli/test/time.py",children:"source/cli/metacallcli/test/time.py"})}),"\n",(0,c.jsx)(i.li,{children:(0,c.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/cli/plugins/cli_cmd_plugin/include/cli_cmd_plugin/cli_cmd_plugin.hpp",children:"source/cli/plugins/cli_cmd_plugin/include/cli_cmd_plugin/cli_cmd_plugin.hpp"})}),"\n",(0,c.jsx)(i.li,{children:(0,c.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/cli/plugins/cli_cmd_plugin/source/cli_cmd_plugin.js",children:"source/cli/plugins/cli_cmd_plugin/source/cli_cmd_plugin.js"})}),"\n",(0,c.jsx)(i.li,{children:(0,c.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/cli/plugins/cli_cmd_plugin/source/test.js",children:"source/cli/plugins/cli_cmd_plugin/source/test.js"})}),"\n",(0,c.jsx)(i.li,{children:(0,c.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/cli/plugins/cli_core_plugin/CMakeLists.txt",children:"source/cli/plugins/cli_core_plugin/CMakeLists.txt"})}),"\n",(0,c.jsx)(i.li,{children:(0,c.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/cli/plugins/cli_repl_plugin/CMakeLists.txt",children:"source/cli/plugins/cli_repl_plugin/CMakeLists.txt"})}),"\n",(0,c.jsx)(i.li,{children:(0,c.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/cli/plugins/cli_repl_plugin/source/cli_repl_plugin.js",children:"source/cli/plugins/cli_repl_plugin/source/cli_repl_plugin.js"})}),"\n",(0,c.jsx)(i.li,{children:(0,c.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/cli/plugins/cli_repl_plugin/source/parser.js",children:"source/cli/plugins/cli_repl_plugin/source/parser.js"})}),"\n",(0,c.jsx)(i.li,{children:(0,c.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/cli/plugins/cli_repl_plugin/source/test.js",children:"source/cli/plugins/cli_repl_plugin/source/test.js"})}),"\n",(0,c.jsx)(i.li,{children:(0,c.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/cli/plugins/cli_sandbox_plugin/CMakeLists.txt",children:"source/cli/plugins/cli_sandbox_plugin/CMakeLists.txt"})}),"\n",(0,c.jsx)(i.li,{children:(0,c.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/cli/plugins/cli_sandbox_plugin/include/cli_sandbox_plugin/cli_sandbox_plugin.h",children:"source/cli/plugins/cli_sandbox_plugin/include/cli_sandbox_plugin/cli_sandbox_plugin.h"})}),"\n",(0,c.jsx)(i.li,{children:(0,c.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/cli/plugins/cli_sandbox_plugin/source/cli_sandbox_plugin.cpp",children:"source/cli/plugins/cli_sandbox_plugin/source/cli_sandbox_plugin.cpp"})}),"\n"]}),"\n",(0,c.jsx)(i.p,{children:"The MetaCall REPL (Read-Eval-Print Loop) provides an interactive shell environment for executing cross-language function calls and managing code loading across different programming languages. This page documents the REPL mode implementation, its architecture, and usage patterns."}),"\n",(0,c.jsxs)(i.p,{children:["For information about CLI commands available in the REPL, see ",(0,c.jsx)(i.a,{href:"/doc/docs/metacall-core/cli-commands",children:"CLI Commands"}),"."]}),"\n",(0,c.jsx)(i.h2,{id:"overview",children:"Overview"}),"\n",(0,c.jsx)(i.p,{children:"The REPL mode serves as an interactive interface to the MetaCall runtime, allowing developers to:"}),"\n",(0,c.jsxs)(i.ol,{children:["\n",(0,c.jsx)(i.li,{children:"Load source files from different programming languages"}),"\n",(0,c.jsx)(i.li,{children:"Evaluate code snippets in various languages"}),"\n",(0,c.jsx)(i.li,{children:"Inspect loaded functions and objects"}),"\n",(0,c.jsx)(i.li,{children:"Call functions across language boundaries"}),"\n",(0,c.jsx)(i.li,{children:"Debug cross-language applications"}),"\n"]}),"\n",(0,c.jsx)(i.p,{children:"The REPL is automatically started when MetaCall CLI is launched without arguments."}),"\n",(0,c.jsx)(i.h2,{id:"architecture",children:"Architecture"}),"\n",(0,c.jsx)(i.h3,{id:"repl-system-components",children:"REPL System Components"}),"\n",(0,c.jsx)(i.h3,{id:"repl-execution-flow",children:"REPL Execution Flow"}),"\n",(0,c.jsx)(i.h2,{id:"initialization-process",children:"Initialization Process"}),"\n",(0,c.jsx)(i.p,{children:"The REPL mode is initialized when:"}),"\n",(0,c.jsxs)(i.ol,{children:["\n",(0,c.jsx)(i.li,{children:"The MetaCall CLI is launched without arguments"}),"\n",(0,c.jsx)(i.li,{children:"The CLI is launched with options but no positional arguments (files to execute)"}),"\n"]}),"\n",(0,c.jsx)(i.p,{children:"During initialization, the following steps are performed:"}),"\n",(0,c.jsxs)(i.ol,{children:["\n",(0,c.jsxs)(i.li,{children:["Load CLI internal plugins from the ",(0,c.jsx)(i.code,{children:"internal"})," directory"]}),"\n",(0,c.jsxs)(i.li,{children:["Load REPL plugins from the ",(0,c.jsx)(i.code,{children:"repl"})," directory"]}),"\n",(0,c.jsxs)(i.li,{children:["Register the ",(0,c.jsx)(i.code,{children:"exit"})," function for terminating the REPL"]}),"\n",(0,c.jsx)(i.li,{children:"Initialize REPL descriptors from plugin path"}),"\n",(0,c.jsx)(i.li,{children:"Start the Node.js-based REPL interface"}),"\n"]}),"\n",(0,c.jsx)(i.h2,{id:"command-processing",children:"Command Processing"}),"\n",(0,c.jsx)(i.h3,{id:"command-format",children:"Command Format"}),"\n",(0,c.jsx)(i.p,{children:"Commands in the REPL follow a specific structure:"}),"\n",(0,c.jsx)(i.pre,{children:(0,c.jsx)(i.code,{children:"command [arg1] [arg2] ...\n"})}),"\n",(0,c.jsx)(i.p,{children:"The first token is treated as the command name, and subsequent tokens are passed as arguments to the command handler."}),"\n",(0,c.jsx)(i.h3,{id:"command-registration-and-parsing",children:"Command Registration and Parsing"}),"\n",(0,c.jsx)(i.p,{children:"Commands are registered in the REPL using a registration system that specifies:"}),"\n",(0,c.jsxs)(i.ol,{children:["\n",(0,c.jsx)(i.li,{children:"Command name"}),"\n",(0,c.jsx)(i.li,{children:"Regular expressions for parsing arguments"}),"\n",(0,c.jsx)(i.li,{children:"Expected argument types"}),"\n"]}),"\n",(0,c.jsx)(i.h3,{id:"command-execution-flow",children:"Command Execution Flow"}),"\n",(0,c.jsx)(i.p,{children:"When a command is executed:"}),"\n",(0,c.jsxs)(i.ol,{children:["\n",(0,c.jsx)(i.li,{children:"The command string is parsed into tokens"}),"\n",(0,c.jsx)(i.li,{children:"The first token identifies the command"}),"\n",(0,c.jsx)(i.li,{children:"If the command is registered, the handler is called with the remaining tokens"}),"\n",(0,c.jsx)(i.li,{children:"The result is returned and displayed in the REPL"}),"\n"]}),"\n",(0,c.jsxs)(i.p,{children:["The ",(0,c.jsx)(i.code,{children:"execute"})," method in the application class handles this process:"]}),"\n",(0,c.jsx)(i.h2,{id:"plugin-system",children:"Plugin System"}),"\n",(0,c.jsx)(i.p,{children:"The REPL mode uses a plugin system to extend its functionality. Plugins are loaded from:"}),"\n",(0,c.jsx)(i.pre,{children:(0,c.jsx)(i.code,{children:"${METACALL_PLUGIN_PATH}/cli/repl/${plugin_name}/${plugin_name}_repl.js\n"})}),"\n",(0,c.jsx)(i.p,{children:"Each plugin can register new commands and provide implementations for those commands."}),"\n",(0,c.jsx)(i.h2,{id:"repl-implementation-details",children:"REPL Implementation Details"}),"\n",(0,c.jsx)(i.p,{children:"The REPL is implemented using the Node.js built-in REPL module, customized with MetaCall-specific evaluator and completer functions:"}),"\n",(0,c.jsxs)(i.table,{children:[(0,c.jsx)(i.thead,{children:(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.th,{children:"Component"}),(0,c.jsx)(i.th,{children:"Description"})]})}),(0,c.jsxs)(i.tbody,{children:[(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:"Prompt"}),(0,c.jsx)(i.td,{children:"Uses the lambda symbol (\u03bb) to indicate input readiness"})]}),(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:"Context"}),(0,c.jsx)(i.td,{children:"Provides an isolated VM context for evaluation"})]}),(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:"Evaluator"}),(0,c.jsx)(i.td,{children:"Custom function that processes commands through the MetaCall parser"})]}),(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:"Completer"}),(0,c.jsx)(i.td,{children:"Provides command completion based on registered commands"})]})]})]}),"\n",(0,c.jsx)(i.h2,{id:"repl-promise-chain",children:"REPL Promise Chain"}),"\n",(0,c.jsx)(i.p,{children:"The REPL implementation uses a promise chain mechanism to manage the asynchronous nature of command evaluation:"}),"\n",(0,c.jsx)(i.p,{children:"This allows the CLI main loop to wait for each command to complete before accepting new input."}),"\n",(0,c.jsx)(i.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,c.jsx)(i.p,{children:"The REPL mode includes comprehensive error handling to:"}),"\n",(0,c.jsxs)(i.ol,{children:["\n",(0,c.jsx)(i.li,{children:"Capture parsing errors from malformed commands"}),"\n",(0,c.jsx)(i.li,{children:"Handle exceptions from command execution"}),"\n",(0,c.jsx)(i.li,{children:"Manage errors from cross-language function calls"}),"\n",(0,c.jsx)(i.li,{children:"Provide meaningful error messages to users"}),"\n"]}),"\n",(0,c.jsx)(i.p,{children:"When an error occurs:"}),"\n",(0,c.jsxs)(i.ul,{children:["\n",(0,c.jsx)(i.li,{children:"If during parsing: The error is wrapped and returned to the application"}),"\n",(0,c.jsx)(i.li,{children:"If during execution: The exception is captured and displayed with its stack trace"}),"\n"]}),"\n",(0,c.jsx)(i.h2,{id:"exiting-the-repl",children:"Exiting the REPL"}),"\n",(0,c.jsx)(i.p,{children:"The REPL mode can be terminated by:"}),"\n",(0,c.jsxs)(i.ol,{children:["\n",(0,c.jsxs)(i.li,{children:["Using the ",(0,c.jsx)(i.code,{children:"exit"})," command"]}),"\n",(0,c.jsx)(i.li,{children:"Pressing Ctrl+C (SIGINT) or Ctrl+D (EOF)"}),"\n"]}),"\n",(0,c.jsxs)(i.p,{children:["The exit function sets the ",(0,c.jsx)(i.code,{children:"exit_condition"})," flag to true, which breaks the main REPL loop and performs cleanup operations."]}),"\n",(0,c.jsx)(i.h2,{id:"available-commands",children:"Available Commands"}),"\n",(0,c.jsx)(i.p,{children:"The REPL comes with a set of built-in commands loaded from the core plugin. These commands include:"}),"\n",(0,c.jsxs)(i.table,{children:[(0,c.jsx)(i.thead,{children:(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.th,{children:"Command"}),(0,c.jsx)(i.th,{children:"Purpose"})]})}),(0,c.jsxs)(i.tbody,{children:[(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"load <tag> <files...>"})}),(0,c.jsx)(i.td,{children:"Load source files with specified loader"})]}),(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"inspect"})}),(0,c.jsx)(i.td,{children:"List all loaded functions"})]}),(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"eval <tag> <code>"})}),(0,c.jsx)(i.td,{children:"Evaluate code snippet with specified loader"})]}),(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"call <function>(<args>)"})}),(0,c.jsx)(i.td,{children:"Call a function with arguments"})]}),(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"clear <tag> <file>"})}),(0,c.jsx)(i.td,{children:"Clear a loaded module"})]}),(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"help"})}),(0,c.jsx)(i.td,{children:"Display help information"})]}),(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"copyright"})}),(0,c.jsx)(i.td,{children:"Show copyright information"})]}),(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:(0,c.jsx)(i.code,{children:"exit"})}),(0,c.jsx)(i.td,{children:"Exit the REPL"})]}),(0,c.jsxs)(i.tr,{children:[(0,c.jsx)(i.td,{children:"Additional commands may be available through plugins."}),(0,c.jsx)(i.td,{})]})]})]}),"\n",(0,c.jsx)(i.h2,{id:"example-usage",children:"Example Usage"}),"\n",(0,c.jsx)(i.p,{children:"Here's a typical usage scenario of the REPL mode:"}),"\n",(0,c.jsx)(i.pre,{children:(0,c.jsx)(i.code,{children:'$ metacall\n\nWelcome to Tijuana, tequila, sexo & marijuana.\n\u03bb load py hello.py\n\u03bb inspect\nhello.greet\n\u03bb call hello.greet("world")\nHello, world!\n\u03bb eval node console.log("JavaScript code in REPL")\nJavaScript code in REPL\n\u03bb exit\nExiting ...\n'})}),"\n",(0,c.jsxs)(i.p,{children:["Sources: ",(0,c.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/cli/plugins/cli_repl_plugin/source/cli_repl_plugin.js#L72-L72",children:"source/cli/plugins/cli_repl_plugin/source/cli_repl_plugin.js72"})," ",(0,c.jsx)(i.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/cli/metacallcli/source/application.cpp#L62-L63",children:"source/cli/metacallcli/source/application.cpp62-63"})]})]})}function h(e={}){const{wrapper:i}={...(0,s.R)(),...e.components};return i?(0,c.jsx)(i,{...e,children:(0,c.jsx)(d,{...e})}):d(e)}}}]);