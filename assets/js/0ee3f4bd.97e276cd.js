"use strict";(globalThis.webpackChunkmetacall_doc=globalThis.webpackChunkmetacall_doc||[]).push([[9790],{3782:(e,a,s)=>{s.r(a),s.d(a,{assets:()=>i,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>n});const r=JSON.parse('{"id":"metacall-core/loader-system","title":"Loader System","description":"Relevant source files","source":"@site/docs/metacall-core/loader-system.md","sourceDirName":"metacall-core","slug":"/metacall-core/loader-system","permalink":"/doc/docs/metacall-core/loader-system","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"Loader System"},"sidebar":"tutorialSidebar","previous":{"title":"Java Loader","permalink":"/doc/docs/metacall-core/java-loader"},"next":{"title":"Loaders","permalink":"/doc/docs/metacall-core/loaders"}}');var l=s(4848),t=s(8453);const o={title:"Loader System"},c="Loader System",i={},n=[{value:"Relevant source files",id:"relevant-source-files",level:2},{value:"Architecture Overview",id:"architecture-overview",level:2},{value:"Loader Interface",id:"loader-interface",level:2},{value:"Interface Methods",id:"interface-methods",level:3},{value:"Loading Process",id:"loading-process",level:2},{value:"Language-Specific Loaders",id:"language-specific-loaders",level:2},{value:"Python Loader (py_loader)",id:"python-loader-py_loader",level:3},{value:"Node.js Loader (node_loader)",id:"nodejs-loader-node_loader",level:3},{value:"Other Loaders",id:"other-loaders",level:3},{value:"Function Call Process",id:"function-call-process",level:2},{value:"Value Type System",id:"value-type-system",level:2},{value:"Asynchronous Support",id:"asynchronous-support",level:2},{value:"Loader Lifecycle",id:"loader-lifecycle",level:2},{value:"Build System Integration",id:"build-system-integration",level:2},{value:"Summary",id:"summary",level:2}];function d(e){const a={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(a.header,{children:(0,l.jsx)(a.h1,{id:"loader-system",children:"Loader System"})}),"\n",(0,l.jsx)(a.h2,{id:"relevant-source-files",children:"Relevant source files"}),"\n",(0,l.jsxs)(a.ul,{children:["\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/cmake/CompileOptions.cmake",children:"cmake/CompileOptions.cmake"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/cmake/FindNodeJS.cmake",children:"cmake/FindNodeJS.cmake"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/deploy/CMakeLists.txt",children:"deploy/CMakeLists.txt"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/cli/metacallcli/test/cli-test-rb.py.in",children:"source/cli/metacallcli/test/cli-test-rb.py.in"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/cli/metacallcli/test/cli-test.py.in",children:"source/cli/metacallcli/test/cli-test.py.in"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/c_loader/CMakeLists.txt",children:"source/loaders/c_loader/CMakeLists.txt"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/cs_loader/CMakeLists.txt",children:"source/loaders/cs_loader/CMakeLists.txt"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/file_loader/CMakeLists.txt",children:"source/loaders/file_loader/CMakeLists.txt"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/js_loader/CMakeLists.txt",children:"source/loaders/js_loader/CMakeLists.txt"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/jsm_loader/CMakeLists.txt",children:"source/loaders/jsm_loader/CMakeLists.txt"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/mock_loader/CMakeLists.txt",children:"source/loaders/mock_loader/CMakeLists.txt"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/node_loader/CMakeLists.txt",children:"source/loaders/node_loader/CMakeLists.txt"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/node_loader/bootstrap/lib/bootstrap.js",children:"source/loaders/node_loader/bootstrap/lib/bootstrap.js"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/node_loader/include/node_loader/node_loader_impl.h",children:"source/loaders/node_loader/include/node_loader/node_loader_impl.h"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/node_loader/include/node_loader/node_loader_trampoline.h",children:"source/loaders/node_loader/include/node_loader/node_loader_trampoline.h"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/node_loader/source/node_loader_impl.cpp",children:"source/loaders/node_loader/source/node_loader_impl.cpp"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/node_loader/source/node_loader_port.cpp",children:"source/loaders/node_loader/source/node_loader_port.cpp"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/node_loader/source/node_loader_trampoline.cpp",children:"source/loaders/node_loader/source/node_loader_trampoline.cpp"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/py_loader/CMakeLists.txt",children:"source/loaders/py_loader/CMakeLists.txt"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/py_loader/include/py_loader/py_loader_dict.h",children:"source/loaders/py_loader/include/py_loader/py_loader_dict.h"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/py_loader/include/py_loader/py_loader_impl.h",children:"source/loaders/py_loader/include/py_loader/py_loader_impl.h"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/py_loader/source/py_loader_dict.c",children:"source/loaders/py_loader/source/py_loader_dict.c"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/py_loader/source/py_loader_impl.c",children:"source/loaders/py_loader/source/py_loader_impl.c"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/py_loader/source/py_loader_port.c",children:"source/loaders/py_loader/source/py_loader_port.c"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/rb_loader/CMakeLists.txt",children:"source/loaders/rb_loader/CMakeLists.txt"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/ts_loader/CMakeLists.txt",children:"source/loaders/ts_loader/CMakeLists.txt"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/loaders/ts_loader/bootstrap/lib/bootstrap.ts",children:"source/loaders/ts_loader/bootstrap/lib/bootstrap.ts"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/ports/py_port/metacall/__init__.py",children:"source/ports/py_port/metacall/__init__.py"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/ports/py_port/metacall/api.py",children:"source/ports/py_port/metacall/api.py"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/scripts/python/pointer/source/pointer.py.in",children:"source/scripts/python/pointer/source/pointer.py.in"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/serials/metacall_serial/CMakeLists.txt",children:"source/serials/metacall_serial/CMakeLists.txt"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/serials/rapid_json_serial/CMakeLists.txt",children:"source/serials/rapid_json_serial/CMakeLists.txt"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/tests/metacall_node_async_test/source/metacall_node_async_test.cpp",children:"source/tests/metacall_node_async_test/source/metacall_node_async_test.cpp"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/tests/metacall_node_test/source/main.cpp",children:"source/tests/metacall_node_test/source/main.cpp"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/tests/metacall_node_test/source/metacall_node_test.cpp",children:"source/tests/metacall_node_test/source/metacall_node_test.cpp"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/tests/metacall_python_async_test/CMakeLists.txt",children:"source/tests/metacall_python_async_test/CMakeLists.txt"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/tests/metacall_python_async_test/source/main.cpp",children:"source/tests/metacall_python_async_test/source/main.cpp"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/tests/metacall_python_async_test/source/metacall_python_async_test.cpp",children:"source/tests/metacall_python_async_test/source/metacall_python_async_test.cpp"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/tests/metacall_python_pointer_test/source/metacall_python_pointer_test.cpp",children:"source/tests/metacall_python_pointer_test/source/metacall_python_pointer_test.cpp"})}),"\n",(0,l.jsx)(a.li,{children:(0,l.jsx)(a.a,{href:"https://github.com/metacall/core/blob/af9cad19/source/tests/metacall_python_port_import_test/source/metacall_python_port_import_test.cpp",children:"source/tests/metacall_python_port_import_test/source/metacall_python_port_import_test.cpp"})}),"\n"]}),"\n",(0,l.jsx)(a.p,{children:"The Loader System is a core component of MetaCall that enables loading, executing, and interoperating with code written in different programming languages. This system acts as a bridge between the MetaCall core and language-specific runtimes (such as Python, Node.js, Ruby), providing standardized mechanisms to load code and invoke functions across language boundaries."}),"\n",(0,l.jsxs)(a.p,{children:["For information about how the Loader System is used by ports, see ",(0,l.jsx)(a.a,{href:"/doc/docs/metacall-core/port-system",children:"Port System"}),"."]}),"\n",(0,l.jsx)(a.h2,{id:"architecture-overview",children:"Architecture Overview"}),"\n",(0,l.jsx)(a.p,{children:"The Loader System follows a modular architecture where a central Loader Manager coordinates with various language-specific loaders."}),"\n",(0,l.jsx)(a.h2,{id:"loader-interface",children:"Loader Interface"}),"\n",(0,l.jsxs)(a.p,{children:["Each language-specific loader implements a common interface defined by the ",(0,l.jsx)(a.code,{children:"loader_impl_interface"})," structure. This interface provides a standard set of operations that all loaders must support."]}),"\n",(0,l.jsx)(a.h3,{id:"interface-methods",children:"Interface Methods"}),"\n",(0,l.jsxs)(a.table,{children:[(0,l.jsx)(a.thead,{children:(0,l.jsxs)(a.tr,{children:[(0,l.jsx)(a.th,{children:"Method"}),(0,l.jsx)(a.th,{children:"Description"})]})}),(0,l.jsxs)(a.tbody,{children:[(0,l.jsxs)(a.tr,{children:[(0,l.jsx)(a.td,{children:(0,l.jsx)(a.code,{children:"initialize"})}),(0,l.jsx)(a.td,{children:"Sets up the loader with required configuration and initializes the language runtime"})]}),(0,l.jsxs)(a.tr,{children:[(0,l.jsx)(a.td,{children:(0,l.jsx)(a.code,{children:"execution_path"})}),(0,l.jsx)(a.td,{children:"Defines a path where scripts can be loaded from"})]}),(0,l.jsxs)(a.tr,{children:[(0,l.jsx)(a.td,{children:(0,l.jsx)(a.code,{children:"load_from_file"})}),(0,l.jsx)(a.td,{children:"Loads code from files on disk"})]}),(0,l.jsxs)(a.tr,{children:[(0,l.jsx)(a.td,{children:(0,l.jsx)(a.code,{children:"load_from_memory"})}),(0,l.jsx)(a.td,{children:"Loads code from a buffer in memory"})]}),(0,l.jsxs)(a.tr,{children:[(0,l.jsx)(a.td,{children:(0,l.jsx)(a.code,{children:"load_from_package"})}),(0,l.jsx)(a.td,{children:"Loads code from a package (specific to each language, e.g., DLLs for C#)"})]}),(0,l.jsxs)(a.tr,{children:[(0,l.jsx)(a.td,{children:(0,l.jsx)(a.code,{children:"clear"})}),(0,l.jsx)(a.td,{children:"Unloads code previously loaded"})]}),(0,l.jsxs)(a.tr,{children:[(0,l.jsx)(a.td,{children:(0,l.jsx)(a.code,{children:"discover"})}),(0,l.jsx)(a.td,{children:"Discovers function signatures and types from loaded code"})]}),(0,l.jsxs)(a.tr,{children:[(0,l.jsx)(a.td,{children:(0,l.jsx)(a.code,{children:"destroy"})}),(0,l.jsx)(a.td,{children:"Cleans up and destroys the loader"})]})]})]}),"\n",(0,l.jsx)(a.h2,{id:"loading-process",children:"Loading Process"}),"\n",(0,l.jsx)(a.p,{children:"The loading process involves several key steps that bridge between the language-agnostic MetaCall API and language-specific runtimes."}),"\n",(0,l.jsx)(a.h2,{id:"language-specific-loaders",children:"Language-Specific Loaders"}),"\n",(0,l.jsx)(a.p,{children:"Each loader implements language-specific mechanisms to initialize the runtime, load code, and bridge between MetaCall's value system and the language's native types."}),"\n",(0,l.jsx)(a.h3,{id:"python-loader-py_loader",children:"Python Loader (py_loader)"}),"\n",(0,l.jsx)(a.p,{children:"The Python loader initializes a Python interpreter, loads Python scripts, and provides bidirectional conversion between Python objects and MetaCall values."}),"\n",(0,l.jsx)(a.p,{children:"Key features:"}),"\n",(0,l.jsxs)(a.ul,{children:["\n",(0,l.jsx)(a.li,{children:"Thread-safe Python interpreter access"}),"\n",(0,l.jsx)(a.li,{children:"Support for Python modules and packages"}),"\n",(0,l.jsx)(a.li,{children:"Type conversion between Python and MetaCall"}),"\n",(0,l.jsx)(a.li,{children:"Supports both Python 2 and Python 3"}),"\n",(0,l.jsx)(a.li,{children:"Support for async/await via asyncio"}),"\n"]}),"\n",(0,l.jsx)(a.h3,{id:"nodejs-loader-node_loader",children:"Node.js Loader (node_loader)"}),"\n",(0,l.jsx)(a.p,{children:"The Node.js loader creates a Node.js runtime environment, loads JavaScript code, and handles asynchronous operations using Node.js event loop."}),"\n",(0,l.jsx)(a.p,{children:"Key features:"}),"\n",(0,l.jsxs)(a.ul,{children:["\n",(0,l.jsx)(a.li,{children:"Bootstrap system to initialize Node.js"}),"\n",(0,l.jsx)(a.li,{children:"JavaScript parsing for function discovery"}),"\n",(0,l.jsx)(a.li,{children:"Promise support for async operations"}),"\n",(0,l.jsx)(a.li,{children:"N-API integration for stable interface"}),"\n",(0,l.jsx)(a.li,{children:"Support for JavaScript modules"}),"\n"]}),"\n",(0,l.jsx)(a.p,{children:"The Node.js loader is particularly complex as it needs to maintain its own thread to run the Node.js event loop:"}),"\n",(0,l.jsx)(a.h3,{id:"other-loaders",children:"Other Loaders"}),"\n",(0,l.jsx)(a.p,{children:"The Loader System includes several other language loaders, each with similar architecture but specialized for their language runtime:"}),"\n",(0,l.jsxs)(a.ul,{children:["\n",(0,l.jsxs)(a.li,{children:[(0,l.jsx)(a.strong,{children:"Ruby Loader (rb_loader)"}),": Integrates with the Ruby interpreter"]}),"\n",(0,l.jsxs)(a.li,{children:[(0,l.jsx)(a.strong,{children:"C# Loader (cs_loader)"}),": Uses CoreCLR to run .NET code"]}),"\n",(0,l.jsxs)(a.li,{children:[(0,l.jsx)(a.strong,{children:"TypeScript Loader (ts_loader)"}),": Transpiles TypeScript to JavaScript and uses the Node.js loader"]}),"\n",(0,l.jsxs)(a.li,{children:[(0,l.jsx)(a.strong,{children:"C Loader (c_loader)"}),": Compiles C code at runtime using TCC"]}),"\n",(0,l.jsxs)(a.li,{children:[(0,l.jsx)(a.strong,{children:"JavaScript V8 Loader (js_loader)"}),": Uses V8 directly without Node.js"]}),"\n"]}),"\n",(0,l.jsx)(a.h2,{id:"function-call-process",children:"Function Call Process"}),"\n",(0,l.jsx)(a.p,{children:"Once code is loaded, the Loader System provides mechanisms to discover and call functions across language boundaries."}),"\n",(0,l.jsx)(a.h2,{id:"value-type-system",children:"Value Type System"}),"\n",(0,l.jsx)(a.p,{children:"A critical aspect of the Loader System is the bidirectional conversion between MetaCall's value system and each language's native types."}),"\n",(0,l.jsx)(a.h2,{id:"asynchronous-support",children:"Asynchronous Support"}),"\n",(0,l.jsx)(a.p,{children:"The Loader System provides support for asynchronous programming models, allowing for non-blocking function calls across languages."}),"\n",(0,l.jsx)(a.h2,{id:"loader-lifecycle",children:"Loader Lifecycle"}),"\n",(0,l.jsx)(a.p,{children:"Each loader follows a standard lifecycle from initialization to destruction."}),"\n",(0,l.jsx)(a.h2,{id:"build-system-integration",children:"Build System Integration"}),"\n",(0,l.jsx)(a.p,{children:"Each loader is built as a separate plugin module that can be loaded at runtime by MetaCall."}),"\n",(0,l.jsx)(a.h2,{id:"summary",children:"Summary"}),"\n",(0,l.jsx)(a.p,{children:"The Loader System is a versatile and extensible component of MetaCall that enables cross-language interoperability. By providing a common interface implemented by language-specific loaders, it allows seamless function calls across different programming languages. Each loader handles the complexities of initializing language runtimes, loading code, and converting between value types, presenting a unified interface to the MetaCall core."})]})}function h(e={}){const{wrapper:a}={...(0,t.R)(),...e.components};return a?(0,l.jsx)(a,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},8453:(e,a,s)=>{s.d(a,{R:()=>o,x:()=>c});var r=s(6540);const l={},t=r.createContext(l);function o(e){const a=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(a):{...a,...e}},[a,e])}function c(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:o(e.components),r.createElement(t.Provider,{value:a},e.children)}}}]);